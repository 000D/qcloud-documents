## CDN配置管理：缓存时间
腾讯云CDN支持配置缓存时间。在接入管理中点击您需要设置的域名，在右侧的管理区域，可以看到缓存时间配置窗口。
![](//mccdn.qcloud.com/img569b8b48df386.png)
1）什么是CDN缓存时间
CDN缓存时间是CDN服务器保存的一套针对用户文件的缓存策略，根据缓存策略判断文件是否超时需要回源。合理配置您的缓存策略，会大大降低回源率，减少源站的压力，节省带宽。
2）全局设置
系统默认所有文件的缓存时间是2592000秒（30天），用户可设置该时间，缓存时间可设置：0秒至4亿秒当中的任意整数秒，如果设置为0，则表示不缓存，文件访问会透传回源站。
3）个性化设置
用户可以新加一列配置个性化的缓存时间，目前支持文件类型、文件夹两种，如：
文件类型 .jpg;.png;.js;.html 300秒
文件夹 /XXXX;/abcd;/1234 500秒

注意：
a) 缓存内容可填入多个项，每个项用“;”分开，内容区分大小写
b) 文件类型必须以“.”开头的文件后缀，如.jpg； 文件夹类型必须以“/”开头，不能以“/”结尾，如/12345/test
c) 用户最多只能添加10个个性化设置，每个设置内容不能超过150字。
d) 缓存时间可以设置任意整数秒，如果设置为0则表示不缓存。
4） 配置项的优先级
根据列表中配置项的顺序来确定优先级，列表底部的优先级大于列表顶部。
如：
规则1：全部类型 所有文件 600秒
规则2：文件类型 .jpg;.png;.js;.html 300秒
规则3：文件夹 /XXXX;/abcd;/1234 500秒
则：
对/XXXX/a.jpg类型，由于内容”/XXXX”命中规则3，列表底部优先，则缓存时间为500秒
对/b.png 类型，由于内容”.png” 命中规则2，列表底部优先，则缓存时间为300秒
对/c.css 类型，由于内容”/c.css”不命中规则2、规则3，故其命中规则1，则缓存时间为600秒
5）**CDN缓存时间规则默认不继承源站http cache_control，以CDN节点服务器设置的默认时间为当前资源的缓存过期时间。
但若源站返回头部包含：Cache-Control: no-cache、Cache-Control: no-store两个字段，则CDN节点服务器将不做缓存；
若要继承源站http cache_control，则可开启“高级缓存过期设置”。**

6）**高级缓存过期设置即指：CDN节点继承源站http cache_control，在CDN节点和源站max_age中取最小值设为缓存过期时间
如： **
/index.htm的max_age是200秒，CDN缓存时间配置600秒，则文件200秒即会超时回源
/index.htm的max_age是800秒，CDN缓存时间配置600秒，则文件600秒即会超时回源
## CDN配置管理：启动、关闭、删除
审核通过的域名，通过后台部署后进入启动状态，可进行CDN加速。
用户可以通过“关闭”操作，将启动状态的域名关闭，关闭后的域名配置保留，但不产生CDN流量。
用户可以通过“删除”操作，将关闭状态下的域名删除，删除后的域名配置被永久删掉。（FTP上上传的资源需用户自行登录ftp删除）。
## CDN配置管理：CDN刷新
文件的回源控制，一般是通过缓存时间来管理的，当文件超时后即回源。详情可参考CDN配置管理——缓存时间。
当您的文件在源站上更新后需要快速回源下发到CDN节点时，可以使用CDN刷新功能。
文件刷新的生效时间是5分钟，当文件配置的缓存时间少于五分钟，建议不使用刷新工具，而是等待超时更新。
## CDN配置管理：回源host
回源host是用于CDN回源到源站时的访问域名，即http请求包包头的host字段内容。 CDN节点会在回源的http请求包host字段里填上该域名，以支持源服务器可通过此host做的特殊逻辑。
1)、回源host配置只能域名在“自有源”方式接入下可修改，默认回源host是您对应的加速域名，即用户访问您服务的域名；
2)、您可以根据需要修改回源host，请保证该域名可以正确访问，否则会出现回源失败的情况。
## CDN配置管理：中间源
中间源即：中间源服务器，是位于业务服务器（即源站）和CDN节点的一个中间层的回源服务器。中间源服务器可缓存CDN节点的回源访问，降低业务服务器（即源站）的访问压力。中间源配置只有在“自有源”方式接入下才可使用。
## CDN配置管理：CDN日志
CDN日志可提供下载日志功能，可下载账户最近30天内CDN日志数据情况；日志内容依次包括：请求时间、访问域名的客户端IP、被访问域名、文件请求路径、本次访问字节数大小、省份、运营商、http返回码、referer信息、request-time、User-Agent
注：
1、当日数据会有延时，不建议参考当日日志数据；
2、日志中记录的带宽或流量是应用层（HTTP协议）回包的大小统计而得，会比由TCP层进行统计得出的结算带宽或流量小，因TCP层有三次握手或丢包重传等机制；
CDN日志地区编码映射表
1：华北地区、2：西北地区、3：东北地区、4：华东地区、5：华中地区、6：西南地区、7：华南地区、8：其他地区；
CDN日志省份编码映射表
22：北京、86：内蒙古、146：山西、1069：河北、1177：天津、119：宁夏、152：陕西、1208：甘肃、1467：青海、1468：新疆、145：黑龙江、1445：吉林,、1464：辽宁、2：福建、120：江苏、121：安徽、122：山东、1050：上海、1442：浙江、182：河南、1135：湖北、1465：江西、1466：湖南、118：贵州、153：云南、1051：重庆、1068：四川、1155：西藏、4：广东、173：广西、1441：海南、0：其他、1：港澳台、-1：海外；
CDN日志运营商编码映射表
2：中国电信、26：中国联通、43：长城宽带、1046：中国移动、3947：中国铁通；
## CDN配置管理：防盗链
防盗链是通过http referer过滤请求内容返回对应信息的配置。http referer是http请求包包头的一部分，当浏览器向web服务器发送请求时，会带上referer，告诉服务器此请求是从哪个链接而来，从而可进行信息的处理。
1)、referer白名单：符合白名单内字符串内容的请求，CDN节点正常返回请求信息；当设置白名单时，CDN节点只能返回符合该白名单内字符串内容的请求；
若用户请求中referer信息不命中，则CDN节点拒绝返回请求信息（如：设置www.test.com为referer白名单，CDN加速域名为：www.abc.com，当用户通过referer信息=www.test.com的http请求访问www.abc.com时，CDN节点才能正常返回该请求信息；若设置了referer白名单后，http请求包包头referer≠www.test.com或referer为空时，CDN拒绝返回该请求信息）；
2)、referer黑名单：符合黑名单内字符串内容的请求，CDN节点将拒绝返回该请求信息；当设置黑名单时， CDN节点拒绝返回符合该黑名单内字符串内容的请求;
若用户请求中referer信息不命中，则CDN节点正常返回该请求信息（如：设置www.test.com为referer黑名单，CDN加速域名为：www.abc.com，当用户通过referer信息=www.test.com的http请求访问www.abc.com时，CDN节点拒绝返回该请求信息；若设置了referer黑名单后，http请求包包头referer≠www.test.com或referer为空时，CDN则正常返回该请求信息）；
注意：
a)、referer黑名单、白名单二者不兼容，同一时间只能生效一种类型；
b)、当防盗链黑、白名单为空时，等同于关闭防盗链，防盗链规则不生效；
c)、防盗链输入内容最多可输200条，以换行符相隔，一行输入一个；
d)、防盗链规则匹配的设定如下：
①、支持域名/ip规则，且为前缀匹配。
如设置www.qq.com，则referer中包含以下的都匹配：
http://www.qq.com
http://www.qq.com/123
http://www.qq.com.cn
如设置127.0.0.1，则referer中包含以下的都匹配：
http://127.0.0.1
http://127.0.0.1/123
②、 支持域名前缀通配符。
如设置*.qq.com, 则referer中包含以下的都匹配：
http://www.qq.com
http://a.qq.com
http://a.b.qq.com/123
③、referer为空（即指用户在浏览器中直接访问域名，则referer为空），空referer默认不匹配任何规则。
即：当referer为空时，若设置黑名单规则，空referer请求不会被黑名单规则拦截，CDN正常返回该请求信息；
当referer为空时，若设置白名单规则，空referer请求不会命中白名单规则，CDN拒绝返回该请求信息。
④、包含空referer
包含空referer即指：选择referer白名单时，白名单中包含空的referer(即：通过浏览器地址栏直接访问该资源URL)时，CDN将正常返回资源信息。

## CDN配置管理：过滤参数设置
过滤参数设置：即指CDN节点将忽略用户的访问URL中"?"之后的参数。
若开启“过滤参数设置”则CDN节点将忽略URL请求中"?"之后的参数。如：用户第一次访问 http://www.test.com/2.jpg，CDN需直接回源访问数据并进行缓存。
用户第二次访问 http://www.test.com/2.jpg?abc，由于开启了“过滤参数设置”，CDN将不进行"?"后的参数匹配，所以不论"?"后面带的是什么参数，无需匹配即可命中CDN缓存 http://www.test.com/2.jpg
若未开启“过滤参数设置”则CDN节点将精确匹配用户的访问URL中"?"之后的参数，用户请求只有精确匹配"?"后面的参数，才能命中CDN缓存内容。如：用户第一次访问 http://www.test.com/1.jpg?abc，CDN需回源访问数据并进行缓存。
用户第二次访问 http://www.test.com/1.jpg?abc，由于未开启“过滤参数设置”，故CDN节点会精确匹配"?"后的参数，匹配成功即命中CDN缓存。
若用户第二次访问 http://www.test.com/1.jpg?efg，由于"?"后的参数”efg”与CDN缓存的“abc”参数不匹配，则不命中CDN节点缓存，CDN需直接回源拉取信息。
**注意：使用FTP托管源的域名，已默认开启过滤参数设置**

## CDN配置管理：托管源帐号设置
1、为什么要设置托管源帐号？
在同一个腾讯云帐号下，有可能出现多个项目并行的情况，为了预防各项目间的信息泄漏，则采用每个项目分配不同权限的账号管理方案。
2、如何设置
（1）、添加帐号
a、进入托管源权限管理，点击“添加”按钮，选择对应项目、业务类型；输入帐号名称、密码，点击“确认”，即完成账号添加。
![](//mccdn.qcloud.com/img569b8b23b8b26.png)
b、其中托管源帐号默认以“APPID_”作为固定前缀，您可添加自定义后缀名称，自定义部分长度为4-20个字符，必须含有：英文字母/数字/特殊字符，这三种类型中的至少两种。
c、密码设置要求：8-15位字符，只能包含大小写字母、数字或标点符号；且大写字母、小写字母、数字和标点符号至少3种。
（2）、删除帐号
进入托管源权限管理，点击删除，在弹出对话框中输入此帐号密码，点击确认删除。
![](//mccdn.qcloud.com/img569b8e53d5e4e.png)
（3）、重置密码
进入托管源权限管理，点击“重置密码”，输入新的帐号密码，确定重置。密码设置要求8-15位字符，只能包含大小写字母、数字以及标点符号；且大写字母、小写字母、数字和标点符号至少有3种。
当重置密码后，系统将会发送提醒邮件至创建者QQ邮箱和当前全局协作QQ邮箱中，请注意查收及保存此邮件信息，避免信息泄露。
![](//mccdn.qcloud.com/img569b8e5f1c061.png)
（4）、注意：
a、原云服务帐号在设置托管源帐号后，仍然可用，且具备最高权限，请注意保管相关帐号和密码信息；
b、针对帐号的每次修改，系统将显示最后修改时间和修改者在页面列表中；
c、同一个项目只有一个托管源帐号和密码；若已经设置，将不能重复再设置。

## CDN配置管理：HTTPS设置（内测）
什么是HTTPS？
HTTPS：超文本传输安全协议（Hypertext Transfer Protocol Secure，缩写为HTTPS，也被称为HTTP over TLS，HTTP over SSL，与HTTP Secure）一种网络安全传输协议。在计算机网络上，HTTPS经由超文本传输协议进行通讯，但利用SSL/TLS来对数据包进行加密。HTTPS开发的主要目的，是提供对网络服务器的身份认证，保护交换数据的隐私与完整性。

腾讯云HTTPS解决方案
腾讯云针对现有用户，提供HTTPS的安全加密方案。本方案有两种解决方法：
1. 客户自带证书。
2. 腾讯提供域名和证书。

方案一：客户提供证书和私钥，托管至腾讯云。
此种方案需要客户提供自带证书，腾讯采用多种技术手段保证证书的安全。客户在使用此服务的时候，需要提前上传证书，在启动此服务后，证书将自动发送到CDN节点。
方案特点：
本方案采用证书和私钥前置于边缘节点的方式实现HTTPS的功能。此种方案最大的难点在于在域名劫持或者边缘节点物理损坏或盗窃导致的证书安全问题。腾讯证书管理系统提供一套完整管理系统保证证书的安全。
1. 统一管理证书，减少证书从提交到部署所经过的处理环节和落地；
2. 管理服务器和边缘节点之间通过密文传输证书，建立双向认证的HTTPS链路；
3. 边缘节点上证书和私钥只存在于内存，不落地磁盘；
4. 管理系统会对证书进行证书链的自动补全以及合法性校验、过期监控等功能。

方案二：腾讯提供域名和证书。
此种方案不需要客户提供证书，但是需要使用腾讯的访问域名。采用此方案，腾讯将全程安全解决方案。客户只需要提供申请后，将腾讯提供的域名作为自己的访问域名，即可提供全程安全服务。腾讯后台将自动为您提供安全证书以保证数据安全。

使用方法：
客户可以在一个正常接入域名中，看到HTTPS的接口入口。点击到配置详情中，将看到一下界面：
![](//mccdn.qcloud.com/img569b8e78732d2.png)
这里您可以选择使用腾讯提供证书方式或者自提供证书方式使用HTTPS服务。
1、腾讯云提供证书方式
(1) 开启：如果选择腾讯提供证书方式，在您选择同意相关服务协议后，将为您创建一条以您当前域名为前缀的腾讯自有的HTTPS域名，您将在域名接入中看到该域名。该域名将继承当前域名的相关配置（当然您可以在正式部署生效后修改配置）。
(2) 关闭：可以有两种方式关闭，一是采用在原来开启的配置详情页中选择关闭，同时开启该服务时加添的域名接入也会删除；另外一种是可以把当前生成的接入域名记录删除。两种方式都会删除之前系统自动添加的接入域名。
![](//mccdn.qcloud.com/img569b8e9892614.png)
2、自提供证书方式
(1) 开启：如果选择自提供证书方式，将看到如下界面，您需要上传您当前网站的证书及KEY。腾讯云将采用多种方式保证您的证书安全，如证书上载均是加密进行、所有数据均是非人工处理、证书部署不落地、多重监控等多重手段进行保障。
**注：当前自提供证书要求证书为 pem格式。**
![](//mccdn.qcloud.com/img569b8ea78f7d6.png)
(2) 关闭：在该域名的配置详情页中选择关闭。
![](//mccdn.qcloud.com/img569b8eb4f40b4.png)
3、关于回源方式选择：
用户在使用HTTPS加速方案的时候，可以选择两种回源方式,HTTP回源或者HTTPS回源。
(1) HTTP方式主要是针对安全要求不高如静态图片等资源，或源站负载能力较弱无法支撑大量的HTTPS的加解密。
(2) HTTPS回源方式主要是针对用户安全要求高，且源站要求强烈支持HTTPS回源的需求。
![](//mccdn.qcloud.com/img569b8ed944a39.png)