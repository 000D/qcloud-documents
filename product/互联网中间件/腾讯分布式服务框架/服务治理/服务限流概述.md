限流主要是保护服务节点或者数据节点，防止瞬时流量过大使服务和数据崩溃，造成服务不可用。当资源成为瓶颈时，服务框架需要对请求做限流，启动流控保护机制。

## 限流原理

在服务提供者端配置限流依赖项，在 TSF 控制台配置限流规则。此时服务消费者去调用服务提供者时，所有的访问请求都会通过限流模块进行计算，若服务消费者调用量在一定时间内超过了预设阈值，则会触发限流策略，进行限流处理。 

TSF 限流方案采用了动态配额分配制，限流中控根据实例的历史流量记录，动态计算预测下一时刻该实例的流量，若所有实例的流量预测值都小于额定平均值（总配额/在线实例数），则以该平均值作为所有实例分配的配额；否则按预测流量的比例分配，且保证一个最小值。



![](https://main.qcloudimg.com/raw/7737445c36e40cc7dbc797fb7cc9b1b8.png)







