## 第二课 登录

### 导语
欢迎来到第二课!

在本节课程中，我们的客户端将向腾讯云完成登录过程。

### 预备知识

本课程要求用户在[实时音视频官网](https://cloud.tencent.com/product/trtc)完成服务开通及应用创建。

### 相关概念
本课程涉及到的概念有:
> * [实时音视频应用](../开发前必看/基本概念.md#实时音视频应用)
> * [应用标识(sdkAppId)](../开发前必看/基本概念.md#应用标识)
> * [账号类型(accountType)](../开发前必看/基本概念.md#账号类型)
> * [用户标识(identifier)](../开发前必看/基本概念.md#用户标识)
> * [用户签名(userSig)](../开发前必看/基本概念.md#用户签名)

### userSig的获取
关于userSig的获取参考[用户鉴权](../开发前必看/基本概念.md#用户签名)

在这里我们可以直接使用开发辅助工具生成userSig

至此，我们可以直接使用生成的userSig，有了这些准备知识，我们可以开始实现我们自己的应用了。

### 初始化iLiveSDK

在登录之前，需要初始化sdk，建议在程序运行时就初始化,示例代码如下,

```c++
#define SDKAppId		后台创建应用对应的SDKAppId
#define AccountType		后台创建应用对应的AccountType

int nRet = GetILive()->init(SDKAppId, AccountType, false);
if (nRet != NO_ERR)
{
	//初始化失败,nRet为错误码
}
else
{
	//初始化成功
}
```

### 调用登录接口

初始化后，即可进行登录，示例代码如下，

```c++
GetILive()->login(identifier, UserSig, [](void* data) {
	//登录成功
}, [](const int code, const char *desc, void* data) {
	//登录失败, code为错误码，desc为错误原因描述
}, NULL);
```

### 源码说明

* 演示代码使用了C++11：

上面登录接口在传入sdk成功和失败回调时，使用了C++11的lambda表达式，如果用户使用的vs2010及更低版本(不支持或不完全支持C++11)，成功和失败的回调需要传入C语言的函数指针;调用示例如下,

```c++
void OnLoginSuc(void* data)
{
    //登录成功
}

void OnLoginErr(const int code, const char *desc, void* data)
{
    //登录失败, code为错误码，desc为错误原因描述
}

GetILive()->login(identifier, UserSig, OnLoginSuc, OnLoginErr, NULL);
```

后续课程都使用lambda表达式，不再重复说明;

* 异步回调都带一个"void* data"参数:

由于回调是用C的函数指针实现的，回调中无法访问回调函数外部的变量，所以，设计了void*参数;异步回调传入的void*参数，会在回调中原封不动地传出；一般是将类对象的this指针传入，在回调中强制转换回类对象指针，然后，通过此指针访问类成员;

* iLiveSDK依赖Windows消息循环:

iLiveSDK内部使用Windows的消息循环机制将回调抛回主线程(GUI线程),方便用户在回调中执行UI操作。所以，如果是Win32控制台程序，在程序中必须要有消息循环,代码如下,

```c++
#include <Windows.h>
MSG msg;
while (GetMessage(&msg, NULL, 0, 0))
{
	TranslateMessage(&msg);
	DispatchMessage(&msg);
}
```

* 本例demo将identifier和userSig写死了，userSig是有有效期的，一般为三个月;如果过期，将会登录失败;用户在运行demo时，需要按照本课所讲的方式生成自己的userSig,然后换成自己的SDKAppId、AccountType、identifier、userSig进行测试;

### 运行结果

![](https://main.qcloudimg.com/raw/0efdf60c32dd0b52070a7e0392b53246.png)


### [源码下载](http://dldir1.qq.com/hudongzhibo/ILiveSDK/Demo/PC/demo_login.zip)

[上一课 集成SDK](集成SDK.md)

[下一课 创建房间](创建房间.md)