## 第二课 创建房间

### 导语
欢迎来到第二课!

在本节课程中，我们的客户端将创建一个房间，开始发布自己的个人直播秀。

### 预备知识
本课程要求用户已完成完成前面课程的学习。

### 相关概念
本课程涉及到的概念有:
> * [房间](../开发前必看/基本概念.md#房间)
> * [角色配置](../开发前必看/基本概念.md#角色配置)

> * **渲染控件**
> 在拿到视频数据时，我们需要一个展示数据的平台，这个就是渲染控件，可以实际对应到一个Android控件


### 添加渲染控件
首先，我们需要在前面的demo布局中添加一个控件来渲染视频:
```
<com.tencent.ilivesdk.view.AVRootView
        android:id="@+id/av_root_view"
        android:layout_width="match_parent"
        android:layout_height="match_parent" />
```

### 创建房间模块
定义一个房间模块与Activity通讯的接口:
```Java
public interface IRoomView {
    // 进入房间成功
    void onEnterRoom();
    // 进房间失败
    void onEnterRoomFailed(String module, int errCode, String errMsg);
    
    // 退出房间成功
    void onQuitRoomSuccess();
    // 退出房间失败
    void onQuitRoomFailed(String module, int errCode, String errMsg);

    // 房间断开
    void onRoomDisconnect(String module, int errCode, String errMsg);
}
```
然后就可以创建房间模块：
```Java
public class RoomHelper implements ILiveRoomOption.onExceptionListener, ILiveRoomOption.onRoomDisconnectListener {
    private IRoomView roomView;

    public RoomHelper(IRoomView view){
        roomView = view;
    }
    // 设置渲染控件
    public void setRootView(AVRootView avRootView){
        ILiveRoomManager.getInstance().initAvRootView(avRootView);
    }
    // 创建房间
    public int createRoom(int roomId){
        ILiveRoomOption option = new ILiveRoomOption()
                .imsupport(false)       // 不需要IM功能
                .exceptionListener(this)  // 监听异常事件处理
                .roomDisconnectListener(this)   // 监听房间中断事件
                .autoCamera(true)       // 进房间后自动打开摄像头并上行
                .autoMic(true);         // 进房间后自动要开Mic并上行

        return ILiveRoomManager.getInstance().createRoom(roomId, option, new ILiveCallBack() {
            @Override
            public void onSuccess(Object data) {
                roomView.onEnterRoom();
            }

            @Override
            public void onError(String module, int errCode, String errMsg) {
                roomView.onEnterRoomFailed(module, errCode, errMsg);
            }
        });
    }
    // 退出房间
    public int quitRoom(){
        return ILiveRoomManager.getInstance().quitRoom(new ILiveCallBack() {
            @Override
            public void onSuccess(Object data) {
                roomView.onQuitRoomSuccess();
            }

            @Override
            public void onError(String module, int errCode, String errMsg) {
                roomView.onQuitRoomFailed(module, errCode, errMsg);
            }
        });
    }

    // 处理Activity事件
    public void onPause(){
        ILiveRoomManager.getInstance().onPause();
    }
    public void onResume(){
        ILiveRoomManager.getInstance().onResume();
    }

    @Override
    public void onException(int exceptionId, int errCode, String errMsg) {
        //处理异常事件
    }

    @Override
    public void onRoomDisconnect(int errCode, String errMsg) {
        // 处理房间中断(一般为断网或长时间无长行后台回收房间)
    }
}
```

### UI开发
同样在房间的Activity的onCreate事件中，可以上面创建的房间模块，并设置渲染控件
```Java
RoomHelper = new RoomHelper(this);
// 获取渲染控件
AVRootView avRootView = findViewById(R.id.av_root_view);
// 设置没有渲染时的背景色为蓝色(注意不支持在布局中直接设置)
avRootView.getVideoGroup().setBackgroundColor(Color.BLUE);
// 设置渲染控件
roomHelper.setRootView(avRootView);
```
界面中可以允许用户输入房间号的，并根据用户输入的房间后创建房间，也可以先直接写死(测试):
```Java
roomHelper.createRoom(1234);
```
如果能够上抛onEnterRoom事件，并且能够看到自己的视频画面，那么恭喜你的房间已经成功创建了

### [源码下载](http://dldir1.qq.com/hudongzhibo/ILiveSDK/Demo/Android/demo_create.zip)


### 常见问题

- onException中收到EXCEPTION_ENABLE_CAMERA_FAILED并且errCode为1，找开摄像头失败
> 1、确认Android设备有摄像头并且可以正常使用
>
> 2、确认后台没有其它应用占用摄像头
>
> 3、如果是Android 6.0以上设备需要确认已申请打开摄像头的动态权限Manifest.permission.CAMERA


[上一课 登录](登录.md)

[下一课 加入房间并视频互动](加入房间并视频互动.md)