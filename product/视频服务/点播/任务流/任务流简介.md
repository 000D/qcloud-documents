## 任务流体系介绍

点播系统支持多种视频处理方式，包括转码、加密、打水印、剪辑、截图等。每一种视频处理操作，都包含大量的参数。例如，对于转码操作，可以指定的参数包括封装格式、码率、分辨率、帧率等，各种参数加起来可能会超过20种。但是，开发者的目标转码格式却通常只有少数几种。为了简化开发者的调用，点播系统提供了**参数模板**机制。即：对于一种视频操作，开发者可以将一系列参数组合成参数模板，并为该模板指定唯一ID。开发者在调用点播相关接口来处理视频时，可以仅指定参数模板，而无需传递一系列复杂参数。

面对各种复杂业务场景，单个视频可能需要使用多种方式进行处理。例如，一个视频，不仅需要进行多码率转码，而且需要对其进行雪碧图截图，还需要截取其首帧作为视频截图。此时开发者肯定希望通过一次调用便可完成所有视频处理操作的发起。除此之外，在视频上传场景，开发者可能希望在视频上传的同时指定如何对视频文件进行处理，而不需要额外发起一次调用。为了解决这一问题，点播系统提供了**任务流**机制。即：开发者可以将一系列视频处理操作预设为任务流，在需要对视频进行处理时，只需要传递任务流的名称即可。

不论是参数模板还是任务流，都是对复杂参数的封装与简化。**参数**、**参数模板**、**任务流**三者之间的关系如下所示：
图1：任务流进行转码操作，转码输出参数模板为1，2两种
![](//mc.qcloudimg.com/static/img/e7abf100655ab5766d3c8fe5c77365dc/image.jpg)
图2：任务流使用某采样截图参数模板进行采样截图操作
![](//mc.qcloudimg.com/static/img/4f8d2128622783736aeb4b5a00b050ae/sample.jpg)
图3：任务流使用某转码参数模板进行转码操作，并以某一水印参数模板设置水印。同时使用某采样截图参数模板进行采样截图操作
![](//mc.qcloudimg.com/static/img/2eae18c9ab9e90171e95227b8a108341/r.jpg)
## 参数模板

参数模板是对一系列操作参数的封装。目前点播系统提供如下几种参数模板。

- [转码参数模板](/document/product/266/8098)；
- [水印参数模板]()；
- [截图参数模板](/document/product/266/8097)；
- [采样截图参数模板](/document/product/266/9050)；
- [雪碧图参数模板](/document/product/266/8099)；
- [视频加密模板]()。


## 任务流

任务流是对一系列视频操作动作的封装。

## procedure
任务流相关接口中用于指定任务流的参数。


### JSON任务流

JSON任务流是较为简单的一种任务流形态，可以理解为：用json描述一个任务流


### Lua任务流
Lua任务流是较为简单的一种任务流形态，可以理解为：用lua描述一个任务流

## 在上传视频时指定视频处理任务流
### 服务端上传
在发起上传API中携带任务流参数：procedure。
示例：vod_procedure=QCVB_SimpleProcessFile(1,0,0,0)
QCVB_SimpleProcessFile参见[预设任务流模板](/document/product//266/10277)


### 客户端上传
在上传签名中携带任务流参数：procedure。
示例：procedure=QCVB_SimpleProcessFile(1,0,0,0)
QCVB_SimpleProcessFile参见[预设任务流模板](/document/product//266/10277)


### URL转拉上传


### 直播录制
推流时携带任务流参数：vod_procedure。 
示例：vod_procedure=QCVB_SimpleProcessFile(1,0,0,0)
QCVB_SimpleProcessFile参见[预设任务流模板](/document/product/266/10277)

## 对已有视频进行处理

### 依照指定任务流处理视频
参见文档[依照指定流程处理视频文件](/document/product/266/9045)

### 对视频文件进行处理
参见文档[对视频文件进行处理](/document/product/266/9642)

## 获取任务流结果
1. 任务流状态变更（或者处理完成）会触发[事件通知-任务流状态变更通知](/document/product/266/9636)。APP后台可据此监听任务流的执行状态。
2. 任务流执行完毕之后，任务结果可以从[GetVideoInfo](/document/product/266/8586)中获取。
