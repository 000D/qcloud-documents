## 事件名称
ProcedureStateChanged

## 事件说明
如果APP配置了事件通知，则在任务流完成之后，点播后台会将该事件通知给APP后台。

APP后台接收该事件通知的方法参见[服务端事件通知简介](/document/product/266/7829)。

> 注意：
> - 任务流过程中，任意任务完成，均会触发回调。

### 参数说明
| 参数名称 | 类型 | 说明 |
|---------|---------|---------|
| version | String | 事件通知版本号，固定为4.0 |
| eventType | String | 事件类型，固定为ProcedureStateChanged |
| data | Object | 具体回调数据 |
| data.status | String | 任务流状态，有PROCESSING和FINISH两种 |
| data.errCode | Integer | 错误码。 0: 成功, 其他值: 失败 |
| data.message | String | 错误信息  |
| data.fileId | String | 文件ID  |
| data.metaData | Object | 视频元信息  |
| data.drm | Object | 文件加密信息  |
| data.processTaskList | Array | 任务流包含的任务列表  |

**metaData（视频元信息）**

| **参数名称** | **类型** | **描述** |
|---------|---------|---------|
| size | Integer | 视频大小。单位：字节 |
| container | String | 容器类型，例如m4a，mp4等 |
| bitrate | Integer | 视频流码率平均值与音频流码率平均值之和。 单位：kbps |
| height | Integer | 视频流高度的最大值。单位：px |
| width | Integer | 视频流宽度的最大值。单位：px |
| md5 | String | 视频的md5值 |
| duration | Integer | 视频时长。单位：秒 |
| videoStreamList | Array | 视频流信息 |
| audioStreamList | Array | 音频流信息 |
| videoStreamList.bitrate | Integer | 视频流的码率，单位：kbps |
| videoStreamList.height | Integer | 视频流的高度，单位：px |
| videoStreamList.width | Integer | 视频流的宽度，单位：px |
| videoStreamList.codec | String | 视频流的编码格式，例如h264 |
| videoStreamList.fps | Integer | 帧率，单位：hz |
| audioStreamList.bitrate | Integer | 帧率。 单位：kbps |
| audioStreamList.samplingRate | Integer | 音频流的采样率。 单位：hz |
| audioStreamList.codec | String | 音频流的编码格式，例如aac |

**drm（视频加密信息）**

| **参数名称** | **类型** | **描述** |
|---------|---------|---------|
| definition | Integer | 规格 |

**processTaskList元素（任务流列表中某一任务信息）**

| **参数名称** | **类型** | **描述** |
|---------|---------|---------|
| taskType | String | 具体任务类型，目前包含Transcode，SampleSnapshot |
| status | String | 任务状态，有PROCESSING,SUCCESS,FAIL三种 |
| errCode | Integer | 错误码。 0: 成功, 其他值: 失败 |
| message | String | 错误信息 |
| input | Object | 任务的输入信息 |
| output | Object | 任务的输出信息 |

**转码任务输入输出信息**

| **参数名称** | **类型** | **描述** |
|---------|---------|---------|
| input.definition | Integer | 规格 |
| input.watermark | Integer | 是否设置水印，1为设置，2为没设置。 是否设置取决于用户转码配置 |
| output.url | String | 视频url |
| output.size | Integer | 视频大小。单位：字节 |
| output.container | String | 容器类型，例如m4a，mp4等 |
| output.bitrate | Integer | 视频流码率和音频流码率之和，单位：kbps |
| output.height | Integer | 视频流高度的最大值。单位：px |
| output.width | Integer | 视频流宽度的最大值。单位：px |
| output.md5 | String | 视频的md5值 |
| output.duration | Integer | 视频时长。单位：秒 |
| output.videoStreamList | Array | 视频流信息，元素字段和元信息中videoStreamList相同 |
| output.audioStreamList | Array | 音频流信息，元素字段和元信息中audioStreamList相同 |

**采样截图任务输入信息**

| **参数名称** | **类型** | **描述** |
|---------|---------|---------|
| input.definition | Integer | 规格 |
| output.imageUrls | Array | 字符串数组，生成的截图url列表 |

## 示例

- 对于[HTTP回调](/document/product/266/7829#http.E5.9B.9E.E8.B0.83)，以下内容为HTTP Post Body；
- 对于[基于消息队列的可靠通知](/document/product/266/7829#.E5.9F.BA.E4.BA.8E.E6.B6.88.E6.81.AF.E9.98.9F.E5.88.97.E7.9A.84.E5.8F.AF.E9.9D.A0.E9.80.9A.E7.9F.A5)，以下内容为[PullEvent接口](/document/product/266/7818)返回包体中eventList.eventContent的内容。

### 示例：

```javascript
{
    "version": "4.0",
    "eventType": "ProcedureStateChanged",
    "data": {
        "vodTaskId": "251000333-mango-c27bdf65ea06646171e714f25f5aac63",
        "status": "PROCESSING",
        "message": "",
        "errCode": 0,
        "fileId": "123123123",
        "isEncrypted": 1,
        "metaData": {
            "size": 10556,
            "container": "m4a",
            "bitrate": 246035,
            "height": 480,
            "width": 640,
            "md5": "b3ae6ed07d9bf4efeeb94ed2d37ff3e3",
            "duration": 3601,
            "videoStreamList": [
                {
                    "bitrate": 246000,
                    "height": 480,
                    "width": 640,
                    "codec": "h264",
                    "fps": 222
                }
            ],
            "audioStreamList": [
                {
                    "codec": "aac",
                    "samplingRate": 44100,
                    "bitrate": 35
                }
            ]
        },
        "drm": {
            "definition": 10
        },
        "processTaskList": [
            {
                "taskType": "Transcode",
                "status": "PROCESSING",
                "errCode": 0,
                "message": "",
                "input": {
                    "definition": 10,
                    "watermark": 1
                }
            },
            {
                "taskType": "Transcode",
                "status": "SUCCESS",
                "errCode": 0,
                "message": "",
                "input": {
                    "definition": 20,
                    "watermark": 1
                },
                "output": {
                    "url": "http://125xx.vod2.myqcloud.com/9fcd41e6vodgzp1251953760/7585975f9031868222912340/f20.mp4",
                    "size": 10556,
                    "container": "m4a",
                    "md5": "b3ae6ed07d9bf4efeeb94ed2d37ff3e3",
                    "bitrate": 246035,
                    "height": 480,
                    "width": 640,
                    "duration": 3601,
                    "videoStreamList": [
                        {
                            "bitrate": 246000,
                            "height": 480,
                            "width": 640,
                            "codec": "h264",
                            "fps": 222
                        }
                    ],
                    "audioStreamList": [
                        {
                            "codec": "aac",
                            "samplingRate": 44100,
                            "bitrate": 35
                        }
                    ]
                }
            },
            {
                "taskType": "SampleSnapshot",
                "status": "SUCCESS",
                "errCode": 0,
                "message": "",
                "input": {
                    "definition": 10
                },
                "output": {
                    "imageUrls": [
                        "http://125xx.vod2.myqcloud.com/vodtrans125xx/14508071098244929440/shotup/xx1.png",
                        "http://125xx.vod2.myqcloud.com/vodtrans125xx/14508071098244929440/shotup/xx2.png",
                        "http://125xx.vod2.myqcloud.com/vodtrans125xx/14508071098244929440/shotup/xx3.png",
                        "http://125xx.vod2.myqcloud.com/vodtrans125xx/14508071098244929440/shotup/xx4.png",
                        "http://125xx.vod2.myqcloud.com/vodtrans125xx/14508071098244929440/shotup/xx5.png",
                        "http://125xx.vod2.myqcloud.com/vodtrans125xx/14508071098244929440/shotup/xx6.png",
                        "http://125xx.vod2.myqcloud.com/vodtrans125xx/14508071098244929440/shotup/xx7.png",
                        "http://125xx.vod2.myqcloud.com/vodtrans125xx/14508071098244929440/shotup/xx8.png",
                        "http://125xx.vod2.myqcloud.com/vodtrans125xx/14508071098244929440/shotup/xx9.png",
                        "http://125xx.vod2.myqcloud.com/vodtrans125xx/14508071098244929440/shotup/xx10.png"
                    ]
                }
            }
        ]
    }
}
```

### 错误码说明

事件通知包体中的errCode字段表示本次视频处理任务的执行结果。其含义参见[视频处理类操作错误码说明](/document/product/266/7783#.E8.A7.86.E9.A2.91.E5.A4.84.E7.90.86.E7.B1.BB.E6.93.8D.E4.BD.9C.E9.94.99.E8.AF.AF.E7.A0.81.E8.AF.B4.E6.98.8E)。
