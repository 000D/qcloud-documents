## 接口名称
ProcessFile

## 功能说明
该接口是点播任务流相关接口中的一个。开发者可以通过该接口对单个视频发起多种处理任务，包括：
1. 视频转码（包括水印、加密）；
2. 采样截图；
3. 生成雪碧图；
4. 使用截图设置封面。

## 事件通知

任务流状态变更（或者处理完成）会触发事件通知-任务流状态变更通知。APP后台可据此监听任务流的执行状态。

更多参见[服务端事件通知简介](/document/product/266/7829)。

## 请求方式

### 请求域名
vod.api.qcloud.com

### 最高调用频率
100次/分钟

## 请求参数说明

| 参数名称 | 必填 | 类型 | 说明 |
|---------|---------|---------|---------|
| fileId | 是 | String | 文件 |
| transcode | 否 | Object | 参见转码控制参数 |
| sampleSnapshot | 否 | Object | 参见采样截图控制参数 |
| imageSprite | 否 | Object | 参见雪碧图控制参数 |
| coverBySnapshot | 否 | Object | 参见使用截图设置视频封面 |
| notifyMode | 否 | String | 任务流状态变更通知模式。Finish：只有当任务流全部执行完毕时，才发起一次事件通知；Change：只要任务流中每个子任务的状态发生变化，都进行事件通知。默认为Finish。 | 
| COMMON_PARAMS | 是 |  | 参见[公共参数](/document/product/266/7782#.E5.85.AC.E5.85.B1.E5.8F.82.E6.95.B0) |

### transcode（转码控制参数）

| **参数名称** | **必填** | **类型** | **描述** |
|---------|---------|---------|---------|
| definition | 是 | Array | 转码输出模板号，参见转码模板。 |
| watermark | 否 | Integer | 参见水印模板。 |
| disableHigherBitrate | 否 | Integer | 是否禁止从较低码率转为较高码率。0：不禁止；1：禁止。默认不禁止。（注1） |
| drm | 否 | Object | 视频加密控制参数，参见视频加密。 | 
| drm.definition | 是 | Integer | 加密方式，参见视频加密模板。 |

> 注1：
> 将低码率视频文件转为高码率视频，会导致无谓的带宽浪费。如果启用该选项，则当目标转码模板的码率高于源视频的码率时，该目标模板将被忽略。例如，假设原始视频的码率为800kbps，目标转码输出模板号为10、20、30、40，码率分别为256kbps，512kbps，1024kbps，2500kbps，则30、40两个转码模板将被忽略，只会转出10和20两个模板。

### sampleSnapshot（采样截图参数）

| **参数名称** | **必填** | **类型** | **描述** |
|---------|---------|---------|---------|
| definition | 是 | Integer | 采样截图模板号，参见采样截图模板 |

### coverBySnapshot（使用截图设置视频封面）

| **参数名称** | **必填** | **类型** | **描述** |
|---------|---------|---------|---------|
| definition | 是 | Integer | 指定时间点截图模板号，参见指定时间点截图模板。 |
| positionType | 是 | String | 截图方式。Time：依照时间点截图；Percent：依照百分比截图。 |
| position | 是 | Integer | 截图位置。对于依照时间点截图，该值表示指定视频第几秒的截图作为封面；对于依照百分比截图，该值表示使用视频百分之多少的截图作为封面。 |

### imageSprite（雪碧图控制参数）

| **参数名称** | **必填** | **类型** | **描述** |
|---------|---------|---------|---------|
| definition | 是 | Integer | 雪碧图截图模板号，参见雪碧图模板。 |


## 请求示例

### 通用视频转码示例
以下示例的含义是：
1. 对视频进行转码，转码输出模板为10，20，30，40，要求禁止将低码率视频转为高码率视频；
1. 转码过程需要设置水印，水印模板号为10；
1. 对视频进行采样截图，采样截图的模板号为10；
1. 对视频进行雪碧图截图，截图模板号为10；
1. 将视频首帧截图设置为封面，截图模板号为10；
1. 任务流中每个子任务的状态发生变化，都需要发起事件通知。


```
https://vod.api.qcloud.com/v2/index.php?Action=ProcessFile
&transcode.definition.0=10
&transcode.definition.1=20
&transcode.definition.3=30
&transcode.definition.4=40
&transcode.disableHigherBitrate=1
&transcode.watermark=10
&sampleSnapshot.definition=10
&imageSprite.definition=10
&notifyMode=Change
&COMMON_PARAMS
```

### 视频加密转码示例

以下示例的含义是：
1. 对视频文件进行转码，目标输出模板为10，20，30，40，要求禁止将低码率视频转为高码率视频；
1. 转码过程需要对视频文件进行加密，使用模板号为10的加密策略进行加密；
1. 当整个任务流执行完毕之后，再发起事件通知。

```
https://vod.api.qcloud.com/v2/index.php?Action=ProcessFile
&transcode.definition.0=10
&transcode.definition.1=20
&transcode.definition.3=30
&transcode.definition.4=40
&transcode.disableHigherBitrate=1
&transcode.drm.definition=10
&notifyMode=Finish
&COMMON_PARAMS
```

## 接口应答

### 参数说明
| 参数名称 | 类型 | 说明 |
|---------|---------|---------|
| code | Integer | 错误码, 0: 成功；其他值: 失败 |
| message | String | 错误信息 |
| vodTaskId | String | 任务id，用户根据此字段匹配[服务端事件通知](/document/product/266/7832) |

### 错误码说明
| 错误码 | 含义说明|
|---------|---------|
| 4000-7000 | 参见[公共错误码](/document/product/266/7783)  |


### 应答示例
```javascript
{
    "code": 0,
    "message": "",
    "vodTaskId": ""
}
```