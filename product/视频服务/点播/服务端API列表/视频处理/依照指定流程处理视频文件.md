## 接口名称
ProcessFileByProcedure

## 功能说明
该接口依照指定的流程参数对视频文件进行处理，可以指定的处理流程主要有：转码、创建雪碧图截图等。目前，具体流程参数需要与腾讯云点播商定。
待处理的视频既可以直接指定，也可以依据一定的流程来生成，比如对多个文件通过剪辑、拼接生成。
*本接口只支持点播4.0*

## 请求方式

### 请求域名
vod.api.qcloud.com

### 最高调用频率
100次/分钟

### 参数说明
| 参数名称 | 必填 | 类型 | 说明 |
|---------|---------|---------|---------|
| fileId | 是 | String | 处理的视频文件的ID |
| gen.clip | 否 | Object | 生成处理视频的剪辑参数，如果指定了fileId参数，忽略本参数 |
| gen.clip.fileList.n | 否 | ObjectArray | 参与剪辑的文件列表，和gen.clip.streamInfo参数必须指定一个 |
| gen.clip.fileList.n.fileId | 是 | String | 文件ID |
| gen.clip.fileList.n.startTimeOffset | 否 | Integer | 剪辑的开始文件内时间偏移，负数表示从文件尾的偏移，默认0 |
| gen.clip.fileList.n.endTimeOffset | 否 | Integer | 剪辑的结束文件内时间偏移，负数表示从文件尾的偏移，不填表示剪辑到文件尾 |
| gen.clip.streamInfo | 否 | Object | 参与剪辑的文件对应的录制信息，和gen.clip.fileList必须指定一个 |
| gen.clip.streamInfo.streamId | 是 | String | 录制的流ID |
| gen.clip.streamInfo.startTime | 是 | Integer | 剪辑的录制开始时间 |
| gen.clip.streamInfo.endTime | 是 | Integer | 剪辑的录制结束时间 |
| gen.concat | 否 | Object | 生成视频的拼接参数，如果指定了fileId参数，忽略本参数 |
| gen.concat.fileIdList.n | 是 | String | 参与拼接的文件的ID，如果指定了gen.clip参数，忽略此参数，采用gen.clip的结果作为拼接的文件列表 |
| gen.concat.dstType | 是 | String | 需要拼接的目标格式 |
| procedure | 否 | String | 流程参数 |
| COMMON_PARAMS | 是 |  | 参见[公共参数](/document/product/266/7782#.E5.85.AC.E5.85.B1.E5.8F.82.E6.95.B0) |

### 请求示例

#### 指定fileId请求示例
以下示例的含义是：
对指定fileId的文件发起任务流

```
https://vod.api.qcloud.com/v2/index.php?ProcessFileByProcedure=
&fileId=12345
&procedure=SomeProcedure
&COMMON_PARAMS
```

#### 通过录制流信息请求示例
以下示例的含义是：
1.把streamId为12345的所有fileId按录制时间区间（15020876538，15020876638）剪辑
2.然后再把剪辑的结果拼接成目标文件，格式是mp4
3.最后对目标文件发起任务流。

```
https://vod.api.qcloud.com/v2/index.php?ProcessFileByProcedure=
&gen.clip.streamInfo.streamId=12345
&gen.clip.streamInfo.startTime=15020876538
&gen.clip.streamInfo.endTime=1502087638
&gen.concat.dstType=mp4
&procedure=SomeProcedure
&COMMON_PARAMS
```

#### 通过指定剪辑文件ID列表请求示例
以下示例的含义是：
1.把fileId为12345的文件按视频内区间（30，100）剪辑，fileId为67899的文件按视频内区间（300，400）剪辑
2.然后再把剪辑的结果拼接成目标文件，格式是mp4
3.最后对目标文件发起任务流。

```
https://vod.api.qcloud.com/v2/index.php?ProcessFileByProcedure=
&gen.clip.fileList.0.fileId=12345
&gen.clip.fileList.0.startTimeOffset=30
&gen.clip.fileList.0.endTime=100
&gen.clip.fileList.1.fileId=67899
&gen.clip.fileList.1.startTimeOffset=300
&gen.clip.fileList.1.endTime=400
&gen.concat.dstType=mp4
&procedure=SomeProcedure
&COMMON_PARAMS
```

## 接口应答

### 参数说明
| 参数名称 | 类型 | 说明 |
|---------|---------|---------|
| code | Integer | 错误码, 0: 成功, 其他值: 失败 |
| message | String | 错误信息 |
| transcodeTaskId | String | 转码任务id（如果流程指定了转码任务 |
| imageSpriteTaskId | String | 雪碧图任务id（如果流程指定了创建雪碧图任务） |

如果流程指定了其他任务，应答参数里会包括相应的任务id。

### 错误码说明
| 错误码 | 含义说明|
|---------|---------|
| 4000-7000 | 参见[公共错误码](/document/product/266/7783)  |
| 1 | 内部错误  |
| 1000 | 无效参数  |
| 1001 | 内部错误  |
| 1003 | 内部错误  |
| 2000 | 内部错误  |
| 10008 | 文件不存在  |
| 10022 | 内部错误 |
| 50005 | Procedure重复任务已存在 |
| 50006 | Procedure任务创建失败 |
| 50007 | Procedure参数无效 |

### 应答示例
```javascript
{
    "code": 0,
    "message": "",
    "transcodeTaskId": "transcode-7a2229a8f1957bfce08ba733fbfd4a3c",
    "imageSpriteTaskId": "CreateImageSprite-4744578227f9abb1e308c6aca7e9195b"
    
}
```
如果开启了回调通知，每个任务完成后会单独回调，参见[服务端事件通知简介](/document/product/266/7829)。
