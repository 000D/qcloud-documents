## 整体流程
![](//mc.qcloudimg.com/static/img/2bbbdbba7baec530e40e05f15ea52fc0/image.gif)
1. 主播 A 正常推流直播，直播码为 streamA
2. 主播 B 正常推流直播，直播码为 streamB
3. 主播 B 向主播 A 请求连麦，并带上自己的推流地址 streamB
4. 主播 A 如果同意连麦，向主播 B 回应一下，于此同时，主播 A 拉取 streamB 的流进行播放（播放器设置为 PLAY_TYPE_LIVE_RTMP_ACC）
5. 主播 B 拉取 streamA 的流进行播放（播放器设置为 PLAY_TYPE_LIVE_RTMP_ACC）
6. 主播 A (或主播B) 根据需要通知服务器做一下混流，这样 CDN 的观众就能看到大小视频叠加的画面了。

## 整体对接
### 步骤一：主播A推流
主播 A 从您的业务后台获取推流防盗链地址 streamA，之后可以用 TXLivePush 进行推流。

在连麦开始前，推流的 setVideoQuality 要切换为 VIDEO_QUALITY_LINKMIC_MAIN_PUBLISHER。该模式中会开启回声抑制（AEC），避免连麦中有回音。

> setVideoQuality 支持推流中直接改变场景模式。

### 步骤二：主播B推流
主播 B 从您的业务后台获取推流防盗链地址 streamB，之后可以用 TXLivePush 进行推流。

在连麦开始前，推流的 setVideoQuality 要切换为 VIDEO_QUALITY_LINKMIC_SUB_PUBLISHER。该模式中会开启回声抑制（AEC），避免连麦中有回音。

> SUB_PUBLISHER 的分辨率和码率都要低于 MAIN_PUBLISHER，毕竟那么小的窗口，很高的分辨率是比较浪费的。

### 步骤三：发起连麦请求
主播 B 向主播 A 发起连麦请求，请求可以由您的业务服务器中转，也可以使用腾讯云的 IM 云通讯解决方案。请求中要带上 主播 B 的推流直播码，否则主播 A 无法拉取主播 B 的视频流。

> 小直播源码中使用了腾讯云的  IM 云通讯解决方案实现了连麦请求的发起和回应。

### 步骤四：接受连麦请求
主播 A 如果接受主播 B 的连麦请求，可以进行回应，这样主播 B 就知道连麦请求已经被同意了。

主播 A 此时要拉取 streamB 的 **低延时** 地址，特别注意，这里不能用普通的 CDN 观看地址。两者最大的区别就是前者的延迟一般在 500ms 以内，而 CDN 的延迟一般在 2s 以上。

所有，要得到 500ms 左右的低延迟播放效果，需要：
- **4.1 给播放地址加防盗链**
低延时链路属于BGP资源，需要有防盗链的 rtmp-liveplay 地址才能访问，所以主播 A 和 主播 B 都要给直播流加上防盗链才能拉到低延迟流。

- **4.2 使用TXLivePlayer播放，并设置为 PLAY_TYPE_LIVE_RTMP_ACC**
LIVE_RTMP_ACC 的模式会开启播放器自带的精准延迟控制模块，该模式下的缓冲处理和音画同步技术相比于普通直播要求高很多。


### 步骤五