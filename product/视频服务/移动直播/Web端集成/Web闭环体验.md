## 功能介绍
如果您的产品中直播内容很好，那么仅靠 APP 的传播势必阻碍产品的发展速度，现在主流的直播平台都非常重视其视频源在社交平台（微信朋友圈、新浪微博等等）上的分享大，然而主流社交平台都只能传播 Web 网页连接，所以能否让您的直播产品以 Web 页面的形式呈现给观众就显得非常重要。

**微信朋友圈分享** 是目前最流行也是最有效果的社交传播方案，本文就以微信分享为例，介绍如何为您的产品构建起 Web 端的闭环体验。

![](//mc.qcloudimg.com/static/img/c7ae656ffdc8f84bf060d7e1e5148edf/image.png)

## 技术难点
要在网页上观看直播，只需要在页面中添加一个 **video标签** 即可，这看似并没有什么难度。然而，要做到较好的用户体验，需要克服很多的技术难点：
- **如何在Android手机浏览器上播放视频？**
Android系统上的浏览器跟Android手机一样，制式和标准各不统一，有些手机调的好好的效果，到了另一款手机上就完全变了样，兼容性问题是个非常耗时耗经验的过程。

- **面对 X5 浏览器内核应当怎样应对？**
Android系统上，从微信或者QQ上点开的网页，基本都是QQ浏览器推出的 X5 内核，X5 内核在视频播放这里有自己的策略和规则，如果您不清楚，会面临很多的坑要踩。

- **如何在Web页面上跟主播文字互动？**
主播用 APP 做直播，观众在网页端观看，那么只有观看没有互动能有什么效果呢？所以我们必须要解决在网页上跟主播互动的难题。

## 账号准备工作
处于对内容源管控方面的考虑，微信对其分享能力的使用是有一些硬性标准的：

- **微信认证通过的公众平台账号**
公众帐号必须升级为认证的服务号才能使用全部的微信 JS API（详细请看微信"开发者中心"——>"接口权限表"）。公众平台账号是面向 Web 页面（即 H5 页面）的，如果要在页面中使用分享能力，这个帐号是必须的。在页面中使用分享能力 需要 Web 前端开发工程师进行简单的开发。

- **微信认证通过的开放平台开发者帐号**
获取开发者帐号，创建移动应用，获取 AppID 和 AppSecret 。与公众平台帐号不一样，微信开放平台是面向APP的。如果需要在APP里使用微信的分享能力，这个帐号是必须的。在 APP 里使用分享能力，需要终端开发工程师进行简单的开发。

-  **一台业务服务器**
服务器（可使用腾讯云主机或静态CDN）的主要用是托管分享用的Web页面，这里一般由前端工程师负责。
同时，服务器上还需要部署一个后端程序，用于获取 access_token、jsapi_ticket 以及生成签名等操作，用于对接微信的各项签名要求，这里一般由后端工程师负责。

- **一个备案过的域名**
这里说的域名，用于指向上文提及的业务服务器，它需要在微信公众平台里进行登记，否则以该域名打头的分享URL即使可以分享出去也打不开。


## 分享URL到微信





## WEB 分享页面

### 1. 
在接入微信的分享能力后，接着就要部署微信里打开的分享Web页面了，它是直接面向观众的页面，本文的主角：

小直播源码集中包含 Web分享页面的 [DEMO源码](https://www.qcloud.com/document/product/454/6991) ，实现了**直播观看**、**文本消息**以及**点赞**等功能。这些功能与小直播 APP 是打通的，也就是说，通过App和通过Web页面进入房间的用户，大部分功能是相同而且互通的。

### 源码能力介绍





### 分享流程细节
- 在小直播 APP 里构造分享URL，并带上需要的参数，传递给分享页面的脚本，做进一步的处理。完整的链接例子：http://imgcache.qq.com/open/qcloud/video/share/xiaozhibo.html?sdkappid=1400012894&acctype=6672&userid=test1234&type=0&ts=1479299174


| 参数名 | 含义 | 参考文档 |
|---------|---------|---------|
| 文本1 | 文本2 | 文本3 |



这里需要特别关注的参数：
* sdkappid
> 所属应用 id，在腾讯云注册后开通云通信服务并创建应用即可生成 sdkappid ，点击查看[具体接入流程](https://www.qcloud.com/document/product/269/1504)。
* acctype
> 用于云通信 IM 登录的帐号类型，获取方式同 sdkappid
* userid
> 主播的ID
* type
> 0 为直播，1为点播

- 当用户在微信或者手机 QQ 里打开分享URL时，分享页里的 Javascript 脚本将会获取 URL 传递过来的这些参数，去小直播的 live demo server 拉取数据，拉取的数据包括视频播放地址，主播的资料，IM 的房间信息等，然后初始化视频播放和IM消息的收发功能。

分享效果图：


### 注意事项
* 不管直播还是点播都会有一个播放地址，需要把播放地址的域名添加到安全域名的列表里，不添加会有可能被微信以"非微信官方网页"为由拦截视频地址，导致不能播放视频。
> 登录微信公众平台进入“公众号设置”的“功能设置”里添加“JS接口安全域名”。设置域名后，该域名的网页内容不会被重新排版或者被拦截，但依然要遵守微信平台运营规则，否则依然会受到相应处罚。 [相关参考](https://www.zhihu.com/question/45748989)




