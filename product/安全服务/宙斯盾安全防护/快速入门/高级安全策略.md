##自定义安全策略

宙斯盾安全防护（Aegis Anti-DDoS）默认提供基础安全策略，策略基于AI智能引擎、IP画像、行为模式分析等算法。可以有效应对常见的DDoS攻击行为。若遭遇到某些特殊或模拟业务特点的攻击行为时，宙斯盾安全防护还提供了高级策略，可以根据业务特点或攻击行为定制。对特定攻击行为进行更有针对性的防护。

高级策略可以绑定到高防IP、高防包防护的IP上，用户可针对业务平台的自身需求配置高级安全策略、HTTP CC防护策略、水印安全策略。当前业务请求在检测到攻击行为时，会按高级策略的配置对攻击流量进行清洗。

###**自定义高级安全防护策略**

![](https://i.imgur.com/Bt8cigi.png)

###高级安全防护策略

禁用协议或端口：客户可禁用业务不使用的协议或端口。当检测到攻击行为时，防护系统会清洗掉该协议或端口的流量。

设置IP黑白名单：源自白名单中IP的业务流量，防护系统不做攻击检测和流量清洗。源自黑名单中IP的业务流量会被清洗。黑白IP名单总共添加不可超过50个IP地址。

报文过滤特征：可以针对业务报文特征或攻击报文特征，配置报文长度，或报文长度+载荷特征为条件的策略。当检测到报文匹配到策略条件时，可以执行丢弃、拉黑源IP或断开连接等操作。

空链接防护：应对空链接攻击。高防包防护的IP若需空链接防护，可开启本功能。

拒绝海外流量：可禁止来源中国（大陆及港澳台）以外的TCP流量请求。

**案例说明：**

如下为一个正常业务报文。

![](https://i.imgur.com/Zx83ZgR.png)

经过分析，其特征如下：

- 目的端口为80；
- 包长在1000字节及以内；
- 载荷以“GET”开头，并且会携带“Host”字段；

因此配置报文特征过滤策略，对不符合正常业务特征的报文进行拦截处理，如下：

满足如下条件的报文：

- 目的端口为80；
- 包长在1000字节及以上；
- 载荷不以“GET”开头，且没有携带“Host”字段；

执行操作：

- 同时命中上述条件做拦截；

![](https://i.imgur.com/cKcf4t8.png)

###CC防护策略

HTTP请求数阈值：当HTTP请求数超过设定的QPS值时，触发CC防护。

URL白名单：添加到白名单后的URL，防护系统不再做CC攻击检测和防护。

IP黑白名单：源自白名单中IP的HTTP访问请求，防护系统不做CC攻击检测和防护。源自黑名单中IP的HTTP访问请求会被拒绝。黑白IP名单总共添加不可超过50个IP地址。

CC自定义防护：主要针对HTTP字段头有相关字段进行阻断或人机验证。

- 匹配模式：匹配到HTTP对应字段头的请求，执行阻断、人机验证等操作


人机验证如下：

![](https://i.imgur.com/sJ0ad2L.png)

- 限速模式：对源IP访问进行限速处理。支持配置全局或指定URL的源IP限速。

配置后，所有源IP访问本策略绑定的高防IP（或高防包的IP）时，其访问频率会受配置值限速控制。配置为0为不启用。指定URL限速的策略优先级高于全局限速策略。


###水印防护
客户可以通过接入水印防护，高效全面防护4层CC攻击，如模拟业务报文攻击和重放攻击等。

- 业务端和宙斯盾防护系统共享水印算法和秘钥。
- 客户端每个发出的包文都嵌入了水印特征。而攻击包文却无水印特征。
- 防护系统将甄别出攻击包文并将其丢弃。

防护IP：将访问该IP和指定端口的业务流量进行水印检测，并将攻击包文识别丢弃。

TCP协议防护端口、UDP协议防护端口：TCP/UDP防护端口最多可以配置5个端口段；不同端口段不可以互相重合；起止端口号相同则认为是一个端口；TCP或UDP协议端口段中需要至少配置一条。

UDP水印剥离：勾选“自动剥离UDP报文水印”。数据报文经过安全防护系统后，自动剥离UDP报文中的水印，再前传到源站。还可以配置指定水印标签在UDP报文中的偏移量0~100。特别注意：若不需要防护系统剥离UDP协议水印，则服务端仍需要做剥离水印的改造。

白名单：勾选“启用源IP白名单”，添加IP。访问白名单中的IP报文不会进行水印检测。