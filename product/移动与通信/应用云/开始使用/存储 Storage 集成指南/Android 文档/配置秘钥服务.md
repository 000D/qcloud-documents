Storage 服务需要一个有效的秘钥提供者，这样后台才能正确地识别您的身份。所以在调用 Storage 任何功能接口前，**请先通过 `TACStorageOptions` 设置秘钥提供者**。

建议您直接在后台服务器集成我们提供的秘钥生成 SDK ，获取包含临时秘钥的 JSON 文本，并通过标准的 HTTP 协议下发到客户端。我们的 Android SDK 会自动完成 JSON 的解析工作。如果您有特殊需求，也可以自定义返回的 JSON 内容，然后在客户端手动解析。

下面的示例代码假设您配置的服务器请求地址是:

```
GET https://<SERVER_HOST><PATH>?<name>=<value>
Header: <header1>=<value1>
```

### 1. 使用 SDK 的标准 JSON 格式

通过 `TACStorageOptions` 配置秘钥获取接口：

```
TACApplicationOptions applicationOptions = TACApplication.options();
TACStorageOptions storageOptions = applicationOptions.sub("storage");

// 配置秘钥获取接口
storageOptions.setCredentialProvider(new HttpRequest.Builder<String>()
	.scheme("https")					
	.host("<SERVER_HOST>")			
	.path("<PATH>")					
	.method("GET")
	.query("<name>", "<value>")		
	.addHeader("<header1>", "<value1>")	
	.build());
```

### 2. 自定义 JSON 格式

通过 `TACStorageOptions` 配置秘钥获取接口和结果解析类，其中解析类必须继承于 `SessionCredentialProvider`:

```
TACApplicationOptions applicationOptions = TACApplication.options();
TACStorageOptions storageOptions = applicationOptions.sub("storage");

// 配置秘钥获取接口和结果解析类，MySessionCredentialProvider 继承于 SessionCredentialProvider
storageOptions.setCredentialProvider(new MySessionCredentialProvider(new HttpRequest.Builder<String>()
	.scheme("https")					
	.host("<SERVER_HOST>")			
	.path("<PATH>")					
	.method("GET")
	.query("<name>", "<value>")		
	.addHeader("<header1>", "<value1>")	
	.build()));
```

下面是手动解析json内容的示例代码：

```
public class MySessionCredentialProvider extends SessionCredentialProvider {
        public MySessionCredentialProvider(HttpRequest<String> httpRequest) {
            super(httpRequest);
        }

        @Override
        protected QCloudLifecycleCredentials onRemoteCredentialReceived(String jsonContent) throws QCloudClientException {
        	// 在这里处理 jsonContent，并返回一个有效的秘钥实例
        	if (jsonContent != null) {
            try {
                JSONObject jsonObject = new JSONObject(jsonContent);
                JSONObject data = jsonObject.optJSONObject("data");
                if (data == null) {
                    data = jsonObject;
                }
                JSONObject credentials = data.optJSONObject("credentials");
                long expiredTime = data.optLong("expiredTime");
                if (credentials != null) {
                    String sessionToken = credentials.optString("sessionToken");
                    String tmpSecretId = credentials.optString("tmpSecretId");
                    String tmpSecretKey = credentials.optString("tmpSecretKey");
                    return new SessionQCloudCredentials(tmpSecretId, tmpSecretKey, sessionToken, expiredTime);
                }
            } catch (JSONException e) {
                throw new QCloudClientException("parse session json fails", e);
            }
        }

        return null;
        }
    }
```


