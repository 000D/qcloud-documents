## 容器服务安全组设置
安全问题向来是一个大家非常关注的问题，腾讯云将安全性作为产品设计中最高原则，严格要求产品做到安全隔离，容器服务同样非常看重这一点，腾讯云的基础网络可以提供充分的安全保障，我们容器服务一期选择了网络特性更丰富的VPC网络来作为容器服务的底层网络，本篇文章主要介绍容器服务下安全组的使用最佳实践，帮助大家选择安全组策略。

### 什么是安全组
安全组是一种有状态的包过滤功能的虚拟防火墙，它用于设置单台或多台云服务器的网络访问控制，是腾讯云提供的重要的网络安全隔离手段。更多安全组的介绍可以查看[安全详细介绍](https://www.qcloud.com/document/product/213/5221).

### 使用容器服务选择安全组的原则

- 1.由于在容器集群中，由于服务实例采用分布式的方式进行部署，不同的服务实例混部在集群的节点上。建议同一个集群下的主机绑定同一个安全组，集群的安全组不添加其他云主机
- 2.安全组只对外开放最小权限
- 3.需放通以下容器服务使用规则：
 - a.放通容器实例网络和集群节点网络
 - b.同一VPC不同集群互访的情况，需要放通对应集群的容器网络和节点网络
 - c.需要SSH登录节点的放通22端口
 - b.放通节点30000-32767端口
 
### 为什么需要放通节点30000-32767端口
-在服务访问中，以外网访问为例(流程图入下图所示)。在访问路径中，需要通过负载均衡器将数据包转发到容器集群的NodeIP：NodePort上.
其中NodeIP为集群中任意一节点的主机IP，而NodePort是在创建服务时容器集群为服务默认分配的，NodePort的范围为30000~32768。
![外网负载均衡访问](https://mc.qcloudimg.com/static/img/497412acf075bdf5d098b4f0ff36bbad/image.png)

### 为什么需要放通容器实例网络和集群节点网络
-在服务访问中，到访问到达主机节点后，会通过Kube-proxy模块设置的iptables规则将请求进行转发到服务的任意一个实例。由于服务的实例有可能在另外的节点上，
这时会出现跨节点访问。访问的目的IP为服务的实例的IP，访问的目的IP为节点IP(或者节点上集群cbr0网桥的IP)。这就需要在对端节点上放通容器实例网络和集群节点网络访问。


### 建议
建议你通过容器服务提供的安全组模板来配置集群的安全组。安全的组具体配置规则如下：

入站规则：
>TCP	30000-32768	0.0.0.0/0	允许
UDP	30000-32768	0.0.0.0/0	允许
All traffic	ALL	10.0.0.0/8	允许
All traffic	ALL	172.16.0.0/12	允许
All traffic	ALL	192.168.0.0/16	允许
TCP	22	0.0.0.0/0	允许
All traffic	ALL	0.0.0.0/0	拒绝

出站规则：
>All traffic	ALL	0.0.0.0/0	允许

容器节点配置该规则，能够满足不同的访问方式访问集群中服务。
集群中服务的访问方式，可以参考[容器服务服务访问方式设置](https://www.qcloud.com/document/product/457/9098)