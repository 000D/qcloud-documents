## 函数运行时的容器模型
SCF 将在事件触发时代表您执行 SCF 函数，根据您的配置信息（如内存大小等）进行资源分配，并启动和管理容器（即函数的执行环境）。SCF 平台负责所有函数运行容器的创建、管理和删除操作，用户没有权限对其进行管理。

在容器启动时需要一些时间，这会使得每次调用函数时增加一些延迟。但是，通常仅在首次调用函数、更新函数、或长时间未调用时重新调用时会察觉到此延迟，因为平台为了尽量减少此启动延时，会尝试对后续调用重用容器，在调用函数后容器仍会存留一段时间，预期用于下次调用。在此段时间内的调用会直接重用该存留的容器。

容器重用机制的意义在于：

- 用户代码中位于[处理方法]()外部的任何声明保持已初始化的状
态，再次调用函数时可以直接重用。例如，如果您的函数代码中建立了数据库连接，容器重用时可以直接使用原始连接。您可以在代码中添加逻辑，在创建新连接之前检查是否已存在连接。
- 每个容器在 `/tmp` 目录中提供部分磁盘空间。容器存留时该目录内容会保留，提供可用于多次调用的暂时性缓存。再次调用函数时有可能可以直接使用该磁盘内容，您可以添加额外的代码来检查缓存中是否有您存储的数据。
```
注意事项：
请勿在函数代码中假定始终重用容器，因为是否重用和单次实际调用相关，无法保证是创建新容器还是重用现有容器。
```

## 函数并发
并发执行是指在任意指定时间对您的函数代码的执行数量。您可以估计并发执行计数，但是，根据 Lambda 函数是否处理来自基于流的事件源的事件，并发执行计数会有所不同。

基于流的事件源 - 如果您创建 Lambda 函数处理来自基于流的服务（Amazon Kinesis Streams 或 DynamoDB 流）的事件，则每个流的分区数量是并发度单元。如果您的流有 100 个活动分区，就会有 100 个 Lambda 函数并发运行。然后，每个 Lambda 函数按照分区到达的顺序处理事件。
并非基于流的事件源 - 如果您创建 Lambda 函数处理来自并非基于流的事件源（例如，Amazon S3 或 API 网关）的事件，则每个发布的事件是一个工作单元。因此，这些事件源发布的事件数（或请求数）影响并发度。
您可以使用以下公式来估算并发 Lambda 函数调用数。
Copy
events (or requests) per second * function duration
例如，考虑一个处理 Amazon S3 事件的 Lambda 函数。假定 Lambda 函数平均用时 3 秒，Amazon S3 每秒发布 10 个事件。因此，您的 Lambda 函数有 30 个并发执行。


### 并发执行限制

默认情况下，AWS Lambda 将给定区域中所有函数的总并发执行数限制为 1000。要将此限制增加为超过默认值，请按照请求提高并发执行数限制中的步骤操作。

如果任何调用导致您的函数的并发执行超过安全限制，则该调用会受到限制，并且不会执行您的函数。每个受限制调用都会提高该函数的 CloudWatch Throttles 指标的值。

根据函数的调用方式，受限制的调用的处理方式会有所不同：

并非基于流的事件源 - 这些事件源中的一部分同步调用 Lambda 函数，另一些则异步调用。
 
同步调用 - 如果函数被同步调用并受限制，则发出调用的应用程序会收到 429 错误，并将负责执行重试操作。这些事件源可能会有内置到集成中的额外重试。例如，CloudWatch Logs 最多会重试失败的批处理五次，在重试之间存在一定的延迟。有关支持的事件源列表以及所用的调用类型，请参阅支持的事件源。
如果您通过 API 网关 调用 Lambda，您需要确保将 Lambda 响应错误映射到 API 网关 错误代码。如果您直接调用该函数（例如使用 RequestResponse 调用模式通过 AWS 开发工具包，或者通过 API 网关），则您的客户端将会收到 429 错误，并且可以选择重试调用。
 
异步调用 - 如果您的 Lambda 被异步调用并受到限制，AWS Lambda 会自动重试受限制的事件，最长六个小时，并在重试之间有一定的延迟。在使用异步事件来调用 Lambda 函数之前，会将它们排队。
 
## 重试机制

Lambda 函数可能会由于以下任意原因而失败：

函数在尝试访问终端节点时超时。
 
函数无法成功解析输入数据。
 
函数遇到资源限制，例如内存不足错误或者其他超时。
如果出现任何这些错误，您的函数可能会引发异常错误。如何处理异常错误取决于 Lambda 函数的调用方式：

并非基于流的事件源 - 这些事件源中的一部分设置为同步调用 Lambda 函数，另一些则异步调用。相应的异常处理方式分别如下：
 
同步调用 - 发出调用的应用程序收到 429 错误并负责重试。有关支持的事件源列表及其使用的调用类型，请参阅支持的事件源。这些事件源可能会有内置到集成中的额外重试。
如果您直接通过 AWS 开发工具包调用 Lambda 函数，或者通过 API 调用，则您的客户端会收到错误并可以选择重试。如果您正在通过 API 网关 调用 Lambda，您需要确保将 Lambda 响应错误映射到 API 网关 错误代码。
 
异步调用 – 使用异步事件调用 Lambda 函数之前会对它们进行排队。如果 AWS Lambda 无法完全处理事件，它将自动重试调用两次，且在重试之间有一定的延迟。如果为函数指定了一个死信队列，那么失败的事件将被发送到指定的 Amazon SQS 队列或 Amazon SNS 主题。如果保留默认设置，不指定死信队列 (DLQ) (非必需操作)，那么系统将丢弃事件。有关更多信息，请参阅 死信队列。
 
基于流的事件源 - 对于基于流的事件源（Amazon Kinesis Streams 和 DynamoDB 流），AWS Lambda 会轮询您的流并调用您的 Lambda 函数。因此，如果 Lambda 函数失败，AWS Lambda 尝试处理错误的记录批次，直至数据过期，对于 Amazon Kinesis Streams 这最多可以为七天。将异常作为阻塞处理，并且 AWS Lambda 不会从流中读取任何新记录，直至失败的记录批次过期或者处理成功。这确保 AWS Lambda 按顺序处理流事件。
有关调用模式的更多信息，请参阅事件源映射。

## 执行环境和可用库

底层 AWS Lambda 执行环境建立在以下各项的基础之上：

公用 Amazon Linux AMI 版本（AMI 名称：amzn-ami-hvm-2016.03.3.x86_64-gp2）：
有关使用 AMI 的信息，请参阅Amazon EC2 用户指南（适用于 Linux 实例） 中的 Amazon 系统映像 (AMI)。
Linux 内核版本 - 4.4.35-33.55.amzn1.x86_64
如果您使用代码中的任何本机二进制文件，请确保在此环境编译这些文件。注意，在 AWS Lambda 上仅支持 64 位二进制文件。

AWS Lambda 支持以下运行时版本：

Node.js – v4.3.2 和 6.10
Java - Java 8
Python – Python 3.6 和 2.7
.NET 内核 – .NET 内核 1.0.1 (C#)
无论您使用哪个支持的运行时，以下库在 AWS Lambda 执行环境中都可用，因此您无需包含它们：

AWS 开发工具包 - 适用于 JavaScript 的 AWS 开发工具包版本 2.22.0
适用于 Python 的 AWS 开发工具包 (Boto 3) 版本 1.4.4，Botocore 版本 1.5.13
适用于 Java 的 java-1.8.0-openjdk 的 Amazon Linux 构建。