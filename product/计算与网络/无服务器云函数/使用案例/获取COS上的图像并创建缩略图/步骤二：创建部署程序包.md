```
使用本示例代码前，请确保您的本地环境为 Linux 且安装了 python。若您本地环境为Windows，则建议您登录一台您名下的 Linux 云服务器进行下面的操作
```
1) 打开文本编辑器，复制以下代码。
```
import uuid
import json
import os
import sys
import urllib
import commands
import logging
from PIL import Image
import PIL.Image
from qcloud_cos import CosClient
from qcloud_cos import DownloadFileRequest
print('Loading function')
appid = 1251111111  #please change to your appid. Find it in Account Info
secret_id = u'AKIDYDh085xQp48161uOn2CKKVbeebvDu9Ib'   #please change to your API secret id. Find it in API secret key pair
secret_key = 'lLkxx40kIfuyqW0IOI0WqyueCYjlgzqE'  #please change to your API secret key. Find it in API secret key pair
region = u'gz'  
     
s3_client = boto3.client('s3')
     
def resize_image(image_path, resized_path):
    with Image.open(image_path) as image:
        image.thumbnail(tuple(x / 2 for x in image.size))
        image.save(resized_path)
     
def handler(event, context):
    for record in event['Records']:
        bucket = record['s3']['bucket']['name']
        key = record['s3']['object']['key'] 
        download_path = '/tmp/{}{}'.format(uuid.uuid4(), key)
        upload_path = '/tmp/resized-{}'.format(key)
        
        s3_client.download_file(bucket, key, download_path)
        resize_image(download_path, upload_path)
        s3_client.upload_file(upload_path, '{}resized'.format(bucket), key)
将文件另存为 CreateThumbnail.py。

如果您的源代码在本地主机上，请复制它。

scp -i key.pem /path/to/my_code.py ec2-user@public-ip-address:~/CreateThumbnail.py

通过 SSH 连接到 64 位 Amazon Linux 实例。

ssh -i key.pem ec2-user@public-ip-address

确保安装基本生产要求项。

sudo yum install python36-devel python27-pip gcc

安装 Pillow 所需的本地依赖项。

sudo yum install libjpeg-devel zlib-devel

创建和激活虚拟环境。

virtualenv ~/shrink_venv

source ~/shrink_venv/bin/activate

在虚拟环境中安装库。

pip install Pillow

pip install boto3

注意
AWS Lambda 包含适用于 Python 的 AWS 软件开发工具包 (Boto 3)，因此您无需将它包含在部署程序包中，但可以选择包含它以用于本地测试。
创建 .zip 文件

zip -9 ~/CreateThumbnail.zip

将 lib 和 lib64 站点程序包的内容添加到 .zip 文件中。请注意，以下步骤假定您使用 Python 运行时版本 3.6。如果您使用版本 2.7，需要进行相应更新。

cd $VIRTUAL_ENV/lib/python3.6/site-packages

zip -r9 ~/CreateThumbnail.zip *

cd $VIRTUAL_ENV/lib64/python3.6/site-packages

zip -r9 ~/CreateThumbnail.zip *

添加 Python 代码到 .zip 文件

cd ~

zip -g CreateThumbnail.zip CreateThumbnail.py