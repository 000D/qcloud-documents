
## Features
Events such as the status change of one LVB stream, generation of a new recorded file, and generation of one screenshot file are internally managed on the Tencent Cloud. Your backend server may also need these events. You can use the Tencent Cloud event notification service to obtain these events.

You  can register one callback URL of your backend server for Tencent Cloud on the console. After an event occurs, Tencent Cloud transfers the event to your server in HTTP POST mode and the event content is organized in the JSON format.

## URL Configuration

![](//mc.qcloudimg.com/static/img/b1df74884171a920e37940a17d2edac2/image.png)
Notifications are organized in the JSON format and then placed in the HTTP POST protocol. Note that "ContentType" in POST format is "application/json" rather than "multipart/form-data". Therefore, <font color='red'>do not use the function for reading the form field in PHP or Java</font> to read information.
The following fields must be carried in all types of notifications:

| Field | Type | Description | Remarks | 
|------------|-------------|---------|---------|
| t           | string      | Validity period  |UNIX timestamp (decimal notation) |
| sign      | string     | Security signature  | MD5(KEY+t) |
| event_type | int     | Event type   | The options include:  0, 1, 100, and 200  |
| stream_id | string     | LVB code   |  It marks the LVB stream that the event is from.  |
| channel_id | string     | LVB code  | It is the same as "stream_id".   |

- **stream_id | channel_id (LVB code)**
 In LVB code mode, "stream_id" and "channel_id" are set to the same value. The two fields coexist because of history causes.

- **t (expiration time)**
  The default expiration duration of notifications from Tencent Cloud is 10 seconds. If the time specified by t in one notification has expired, the notification is invalid. The field aims at preventing network replay attacks. The value of t is a UNIX timestamp in decimal notation, that is, the number of seconds that have elapsed since January 1, 1970 (UTC/GMT midnight).

- **sign (security signature)**
  <font color='blue'>sign = MD5(key + t) </font>: Tencent Cloud combines the strings of the encryption key and t and computes the sign value by using the MD5 algorithm, and places the value in a notification. Then, after receiving the notification, your backend server can check whether the sign value is correct by using the same algorithm so as to check whether the notification is from Tencent Cloud backend.
	
	The encryption key here is CGI calling key. You can specify the key when activating the LVB code service on the Tencent Cloud LVB console, as shown in the following figure:
![](//mc.qcloudimg.com/static/img/28a16dbab36fc3867301d2311204b8e4/image.png)

- **event_type (notification type)**
  Currently, Tencent Cloud supports three types of notifications: 0 — stream interruption; 1 — push; 100 — generation of a new recorded file; 200 — generation of a new screenshot file.
	
## Different Types of Message Bodies
### (1) Push (0) Stream Interruption
**event_type = 0** indicates stream interruption, **event_type = 1** indicates push. In addition, the message body carries the following information: 

| Field name  | Type        | Description        |
|-------------|-------------|--------------|
| appname | string      | Push path  |
| app         | string      | Push domain name  |

Example: Tencent Cloud notifies that a stream interruption (event_type=0) occurs on the LVB stream (1234_15919131751).

```json
{
    "app": "1234.livepush.myqcloud.com",
    "appname": "live",
    "channel_id": "1234_15919131751",
    "event_type": 0,
    "sign": "fef79a097458ed80b5f5574cbc13e1fd",
    "stream_id": "1234_15919131751",
    "t": 1473126233
}
```


### (100) New Recorded File
**event_type = 100** indicates that a new recorded file is generated. In addition, the message body carries the following information:

| Field name  | Type        | Description        |
|------------  |-------------|-------------|
| video_id   | string      | VID used for VOD. It can be used to uniquely locate a VOD file on the VOD platform.  |
| video_url  | string      | Download address of a VOD video  | 
| file_size  | string       | File size  |
| start_time  | int      | Start time (UNIX timestamp. The time cannot be accurate to seconds due to interference of the I frame position.)  |
| end_time  | int       | End time (UNIX timestamp. The time cannot be accurate to seconds due to interference of the I frame position.)  |

Example: A new FLV recorded fragment with the ID of 9192487266581821586 is generated and the play address is 'http://200025724.vod.myqcloud.com/200025724_ac92b781a22c4a3e937c9e61c2624af7.f0.flv'.
```json
{
    "channel_id": "1234_15919131751",
    "end_time": 1473125627,
    "event_type": 100,
    "file_format": "flv",
    "file_id": "9192487266581821586",
    "file_size": 9749353,
    "sign": "fef79a097458ed80b5f5574cbc13e1fd",
    "start_time": 1473135647,
    "stream_id": "1234_15919131751",
    "t": 1473126233,
    "video_id": "200025724_ac92b781a22c4a3e937c9e61c2624af7",
    "video_url": "http://200025724.vod.myqcloud.com/200025724_ac92b781a22c4a3e937c9e61c2624af7.f0.flv"
}
```

### (200) New Screenshot File 
**event_type = 200** indicates that a new screenshot picture is generated. In addition, the message body carries the following information:

| Field        | Type       | Description    |
|-------------------|-------------|---------|
| pic_url           | string      | Picture URL |
| create_time   | int           |Screenshot capture timestamp (UNIX timestamp. The time cannot be accurate to seconds due to interference of the I frame position.) |

Example: The LVB stream with the ID of 2016090090936 generates a new screenshot picture on the Tencent Cloud:

```json
{
    "channel_id": "2016090090936", 
    "create_time": 1473645788, 
    "event_type": 200, 
    "pic_url": "/2016-09-12/2016090090936-screenshot-10-03-08-1280x720.jpg", //File path
    "sign": "8704a0297ab7fdd0d8d94f8cc285cbb7", 
    "stream_id": "2016090090936", 
    "t": 1473646392
}
```

>**Picture downloading address**
> pic_url is not the real picture downloading address but a downloading path. The real downloading address is generated by combining the following items:
> - Downloading prefix: `http://(cos_bucketname)-(cos_appid).file.myqcloud.com/`
> - Downloading path: `/2016-09-12/2016090090936-screenshot-10-03-08-1280x720.jpg`
> - Complete URL: `http://(cos_bucketname)-(cos_appid).file.myqcloud.com/2016-09-12/2016090090936-screenshot-10-03-08-1280x720.jpg`
> 
> "cos_appid" and "cos_bucketname" are available only after you activate the [Cloud Object Storage] (https://console.qcloud.com/cos) on the Tencent Cloud and bind it to the LVB screenshot service.


## Notification Reliability
Many customers are worried about the message loss. For example, if the customer server crashes for a while, will messages be lost?
The message reliability guarantee mechanism of Tencent Cloud backend is implemented based on **simple retransmission**, that is, <font color='blue'>if a notification is not successfully sent to the specified callback URL, Tencent Cloud will retry 100 times repeatedly. </font> 

Then, how to check whether a message is sent to your server successfully? This requires the assistance of your server: <font color='red'>When your server receives an HTTP event notification successfully, please reply:</font> 

```json
// Return the error code 0 in the HTTP request that indicates the message notification is received, to indicate that the message is received successfully, so as to prevent Tencent Cloud from repeatedly sending the notification.
{ "code":0 }
```

Meaning: I've already got the notification. Please do not send me the same messages.





