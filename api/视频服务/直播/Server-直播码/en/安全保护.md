﻿﻿
## Functions
Security hotlink protection is an URL with a hotlink protection signature. The URL with signature can work with the security mechanism of Tencent Cloud server to limit the URL operation permission to your APP. Malicious third parties cannot use or propagate the URL even if they get the URL.

(1) **Push** - It is highly necessary to add the hotlink protection signature to the push URL, especially when the LVB code is bound with the user ID. The LVB code IDs of famous VJs can be easily stolen by attackers, and the attackers can pretend to be the VJs to push streams in preemptive mode. Therefore, the hotlink protection signature needs to be added to the push URL to ensure only authentic VJs can get the hotlink protection signatures after login.

(2) **Play** - It is not completely necessary to add the hotlink protection signature to the play URL. It is valuable only when your video source is a hot resource (for example, exclusive event LVB), and the hotlink protection signature can prevent your competitors from obtaining the play address and playing the program on their APPs. Hotlink protection introduced to play addresses require a hotlink protection signature prior to play. As a result, the LVB cannot be opened stably.

## Principle Introduction
The following figure shows typical security hotlink protection URLs. Such URLs have a common feature: the **txSecret** and **txTime** parameters are added to the end of the original push or play addresses.

![](//mccdn.qcloud.com/static/img/b75148662176ff29eef17210b5d3d4f1/image.png)

**txTime** specifies the validity period of an URL, for example, 5 minutes. If the URL is used again after 5 minutes, Tencent Cloud considers that the URL has expired and rejects the request.

"txTime" alone is meaningless. Any attacker can add one "txTime" with the validity period of 100 days to the end of a stolen URL. Therefore, Tencent Cloud needs a security measure to ensure that attackers cannot forge "txTime", and this security measure is **txSecret**.

**txSecret** is a security signature computed by your server by using the following formula: **txSecret = MD5( KEY + stream_id + txTime )**

>- **Key**
>  The key is the **security key** that your server and Tencent Cloud need to submit or exchange on the console. You need to ensure that no third party can obtain it and change it periodically.
>	
>- **stream_id**
>	It is the LVB code. When many VJs are online simultaneously, "txTime" of the VJs may be the same and "stream_id" is used to prevent duplication.
>	
>- **MD5**
>	MD5 is the most famous unidirectional irreversible hash algorithm. The MD5 algorithm is irreversible, and therefore, attackers cannot compute the key reversely based on "txSecret", and cannot compute "txSecret" that can pass Tencent Cloud verification based on the forged "txTime".


## Combination Method
The security hotlink protection mechanism needs the collaboration of the customer server and Tencent Cloud backend. See the following figure.
![](//mccdn.qcloud.com/static/img/4ea1512fd335f68f30cca0a01e902966/image.png)

- **Step1 - Exchange the key.**
You need to negotiate one **encryption key** on the console at the official website. This encryption key is used to generate a hotlink protection signature on your server. Tencent Cloud has the same key as yours, and therefore, Tencent Cloud is capable of decrypting and acknowledging the hotlink protection signature generated by your server.
 ![](//mc.qcloudimg.com/static/img/6dcddb480ffab18886d8b245a2707af9/image.png)

 > The play hotlink protection key cannot be frequently changed in the debugging phase because of long synchronization period. Contact us if you need to change the key.

- **Step 2 - Generate "txTime".**
In the signature, the plaintext is "txTime", which indicates the URL validity period. For example, if the current time is 2016-07-29 11:13:45 and the generated URL is expected to expire after 5 minutes, "txTime" can be set to "2016-07-29 11:18:45".

 The long time string occupies large space in the URL. In actual applications, "2016-07-29 11:18:45" is converted into the UNIX timestamp. that is, 1469762325 (the various backend programming languages are directly handled by available time functions in the conversion). Then, the timestamp is converted into a value in hexadecimal notation, that is, txTime = 579ACB15.

- **Step 3 - Generate "txSecret".**
"txSecret" is generated as follows: txSecret = **MD5(KEY+ stream_id + txTime)**. The key here is the encryption key exchanged with Tencent Cloud in Step 1, "stream_id" is "8888_test001" in this example, "txTime" is "579ACB15" calculated above, and MD5 is the standard unidirectional irreversible hash algorithm.

- **Step 4 - Combine to obtain the hotlink protection address.**
  After you obtain the push (or play) URL, "txTime" used to notify Tencent Cloud of the URL expiration time, and "txSecret" that can be decrypted only by Tencent Cloud and is used for verification, you can combine them to obtain a hotlink protection security URL.
