## Functions

The Tencent Cloud video broadcast player Web SDK allows users to directly use the verified video play capability. Through flexible APIs, Web SDK can quickly integrate with the proprietary Web application in order to implement the play function of desktop applications.  Besides, the Web SDK provides the capability of uploading videos through Web pages.  <br>
The files that can be played by the Web SDK are limited by the global hotlink protection function.  For details, refer to the FAQs on the official website.  <br>
This document is intended for developers who are considering using the Tencent Cloud Wed SDK for development and are mastering the basis of the JavaScript language. 



## Supported Formats


### Play Formats
The following table lists the video formats that the Web SDK supports:

|Play Format    | PC Browser   | Smartphone Browser |
|-------------|------|--------|
| HLS (m3u8) | Yes | Yes   |
| RTMP        | Yes | No |
| FLV         | Yes | No |

> **Android system compatibility problem**
> Unlike iPhone that has merely one Safari browser installed, Android smartphones can have a variety of browsers installed. Therefore, Android smartphone browser compatibility is an industrial problem. The browser supported formats in the table **do not apply to all Android smartphones**. 


## Preparation

### Step 1: Provision the services
Register for a Tencent Cloud account and provision the **video broadcasting** services.
### Step 2: Create a channel
Enter the video broadcasting console and create a video broadcasting channel. <br>"Video Broadcasting Management"(https://console.qcloud.com/live)
### Step 3: Obtain an ID
You can find the video broadcasting channel on the console and manage the channel.  You can find the application ID (app_id) on the console interface. In **Basic Settings**, you can query the channel ID.

![](//mc.qcloudimg.com/static/img/c891d20153fe9e46e1647bd7494ab021/image.png)

### Step 4: Preparing pages
Introduce the initial script to the pages (including PC or H5) that are required to play videos. 


```
<script src="//qzonestyle.gtimg.cn/open/qcloud/video/live/h5/live_connect.js" charset="utf-8"></script>;
```



>Note: **<font color="red">The play pages must be configured with IP addresses or domain names. Directly opening the local static pages will not play the videos.</font>**

> Remark: The channel ID and application ID can be obtained through the CVM APIs. For details. refer to "URLs of References"(https://www.qcloud.com/doc/api/258/4714). 


## Basic Methods for Calling APIs

### Step 1: Add a player container

 Add the player container on the page that the player needs to be displayed.<span class="VJ" id="step1"><span id="basic_use"></span>

 For example, add the following code in index.html: 
```
<div id="id_video_container" style="width:100%; height:auto;"></div>
```
The container ID, width, and height can be defined. 

### Step 2: Create a player object

Create a player object in the JavaScript that is introduced at the page bottom. In this case, the player constructor will be used. 
```
var player = new qcVideo.Player("id_video_container", {
"channel_id": "16093104850682282611",
"app_id": "1251783441",
"width" : 480,
"height" : 320
});
```
Calling the constructor will generate a player object and find corresponding video stream to play based on the channel ID and application ID.  If there are not the channel ID and application ID, the video can be played based on the video address. For detailed instance, refer to Case 3 in "API Cases"(#case3).  You can control the player based on the player object.  For details on parameters of the player object, refer to the API Overview in the following section. 

### Instance Code
```
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0"/>
    <title>LVB</title>
</head>
<body>
<div id="id_video_container" style="width:100%; height:auto;"></div>
<script src="//qzonestyle.gtimg.cn/open/qcloud/video/live/h5/live_connect.js" charset="utf-8"></script>
<script type="text/javascript">
    (function () {
        var player = new qcVideo.Player("id_video_container", {
            "channel_id": "16093104850682282611",
            "app_id": "1251783441",
            "width" : 480,
            "height" : 320
        });
    })()
</script>
</body>
</html>
```

## API Cases

>Note: An API cannot be called before the player container is added according to "step1"(#step1) in "Part 4 Basic Calling Methods of APIs"(#basic_use). 

### Case 1 LVB over a PC or Smartphone (H5)

**The Web SDK use method is the same on the PC and H5. The Web SDK will detect the platform and select a best play solution**.  For example, when detecting a PC platform, the Web SDK will prefer a flash player in order to adapt to different video formats (the flash player version must be later than 10, otherwise, the system will prompt users to upgrade the flash player). When detecting a smartphone H5, the Web SDK will prefer a video label to player videos (If the browser does not support H5, the system will prompt users to install a QQ browser).  The Web SDK supports play based on channel ID and video file address. 
>Remark: The two play methods cannot be used at the same time. 

### Case 2: Playing Video Based on Channel ID
```
var option = {
"channel_id": "16093425727656143421",
"app_id": "1251132611",
"width" : 480,
"height" : 320

// ... You can fill in other optional attributes
};

var player = new qcVideo.Player("id_video_container", option);
```
**Note: Live video cannot be played based on channel ID.**
### Case 3: Playing Video Based on LVB Address 
If there are not application ID and channel ID, the Web SDK can play videos based on the LVB address as well.  <span class="VJ" id="case3">
```
var option = {
"live_url" : "http://2157.liveplay.myqcloud.com/2157_358535a.m3u8",
"live_url2" : "http://2000.liveplay.myqcloud.com/live/2000_2a1.flv",
"width" : 480,
"height" : 320

// ... You can fill in other optional attributes
};

var player = new qcVideo.Player("id_video_container", option);
```

> Remark: Two video addresses live\_url and live\_url2 can be imported. If both the addresses are imported, the Web SDK will select an address to play videos.  For example,   on a PC platform, the Web SDK will select RTMP or FLV format to play videos; on a smartphone H5 platform, the Web SDK will select HLS format to play the videos. 

### Case 4: Using the Bullet Screen
After the Web SDK is initialized, call the addBarrage(barrage) API of the player object to add bullet screens for videos.  For details on relevant parameters, refer to the API Overview.

To add two bullet screens for the video that is being played, 

```
var barrage = [
{"type":"content", "content":"hello world", "time":"1"},
{"type":"content", "content":"center", "time":"1", "style":"C64B03;30","position":"center"}
];
player.addBarrage(barrage);
```
>Remark: <font color="red">The bullet screen function is implemented on the frontend. Developers can develop the function on the backend.  Bullet screens are valid in PC Flash players only. At present, this function cannot be implemented on H5. </font>


##  API Overview

### 1. Constructor

```
qcVideo.Player(id, option, listener);
```

 **id**: String;  <font color="red">mandatory</font>; indicates the ID of a container that holds the player. This parameter can be set as required. 

  **option**: Object; <font color="red">mandatory</font>; indicates the parameters that can be set. The following table lists the parameters that can be set.

| Parameter             | Type   | Default Value | Description   |
|------------------|--------|--------|---------------------------------------------------------------------------------------------------|
| channel\_id      | String | None     | The parameter is <font color="red">mandatory</font> if videos are played based on video ID.                                                                    |
| app\_id          | String | None     | The parameter is <font color="red">mandatory</font> if videos are played based on video ID. For the videos under the same account, this parameter is consistent.                                            |
| width            | Number | None     | <font color="red">Mandatory</font>. Example: 640. This parameter sets player width (unit: pixel).                                                        |
| height           | Number | None     | <font color="red">Mandatory</font>. Example: 480. This parameter sets player height (unit: pixel).                                                        |
| cache\_time      | Number | 0.3    | This parameter indicates the maximum cache time before live video starts to play. By setting this parameter, the RTMP video freezing problem can be avoided if the downlink bandwidth is insufficient. This parameter is optional. <br> <font color="red">Remark: This parameter is valid to PC flash players only.</font>   |
| h5\_start\_patch | Object | None     | This parameter indicates patch start before H5 video play. This parameter is optional. <br>{ <br>url : Indicates a screen address. <br>stretch:  The default value of this parameter is false. //This parameter decides whether to stretch the screen to cover the entire player.<br>}                                                                                                  |
| wording          | Object | None     | This parameter defines the announcement (optional parameter. For details, refer to "Error Codes"(#errorcode))<br>{	<br>	'1' 	: 'Database error',<br> '2'		: 'Failed to connect to the LVB source, because the LVB source does not push video content (hls)',<br> '3'		: 'The LVB has finished(hls)',<br>'113'	: 'Connection times out. Please try again later',<br>'114'	: 'Connection times out. Please try again later',<br>'1000'	: 'Channel ID or application ID error',<br>'1001'	: 'Invalid parameter. Obtaining the BIZ ID fails',<br>'1009'	: 'The LVB source has expired',<br>'10000'	: 'Request times out. Please check the network setting',<br> '10008'	: 'Password error. Please reenter', //Invalid password<br>'10020'	: 'The remaining balance in the account is insufficient. Please recharge in time',  <br>'11044'	: 'Invalid request',<br> '11045'	: 'The request parameters lack the channel ID',<br> '11046'	: 'Password error. Please reenter',<br> '20110'	: 'Password error. Please reenter',<br>'20113'	: 'The LVB has finished. Please try again later' , //'downstream type is not exist' The pull stream does not exist<br>'20201'	: 'The LVB has finished. Please try again later', //get upstream info error'  An error occurs during pushing<br> '20301'	: 'The LVB channel does not exist. Please check the channel ID',<br>'TipReconnect'	: 'Reconnecting'<br>'TipRequireSafari'	: 'Current browser does not support video play. Please open a safari browser to view videos'<br>'TipRequireFlash'	: 'Current browser does not support video play, download the latest QQ browser or install the flash player to play to video'<br>'TipVideoinfoResolveError'	: 'An error occurs during video information parsing. Please check parameter setting', //The API does not return JSON data, so the video information cannot be parsed<br>'TipVideoinfoError'	: 'The video information is wrong, Please check parameter setting',<br>'TipConnectError'	: 'Connecting to services fails. Please check network setting',<br>'TipConnectDeny'	: 'The service connection request is rejected', //because the flash request triggers a security exception<br>'TipLiveEnd'		: 'The LVB has finished. Please try again later',  // The NetStream.Play.Stop event occurs, <br>'TipStreamNotFound'	: 'The LVB has finished. Please try again later' //Failed to connect to the LVB source, because the LVB source does not push content.<br>}                                                                                                 |
| live\_url        | String | None     | This parameter indicates a video address. the HLS, RTMP, and FLV formats are supported. <br>This parameter is <font color="red">mandatory </font> if video is played based on the video address.                                                                      |
| live\_url2       | String | None     | This parameter indicates a video address as well, but it is optional.                                                                        |
| volume           | Number | 0.5    | This parameter sets the initial volume. Value range: 0 to 1; default: 0.5. (Optional) <br><font color="red">Remark: This parameter is valid to flash players only.</font>                                                                    |
| https             | Number | 0   | This parameter enables or disables the HTTPS for player pages. 0: disabled; 1: enabled.                                                                    |
| hide_volume_tips  | Number | 0   | This parameters hides or displays the volume tip. 0: displayed; 1: hidden <br><font color="red">This parameter is valid to flash players only.</font>                                                                    |
| x5_fullscreen     | String | None   |This parameter indicates a full screen mode during video player. Value:   true: Indicates that the full screen mode is enabled. This property is an experimental property of the TBS core. For non-TBS core, this property is not supported. For details, refer to "TBS Document".(http://x5.tencent.com/guide?id=4000) )                                                       |

| Function Name                                                 | Type     | Description   |
|----------------------------------------------------------|----------|----------------------------------------------------------------------------------------------------------------------------------|
| playStatus<span id="playstatus" class="VJ"></span> | function | This parameter is triggered in case of play status change. The parameter status of the callback function is a string. <br>Returned message: <br>ready:   "The player is ready", playing: "Playing", playEnd: "Play has finished", error:   "Play has finished exceptionally or an error occurs" //Since the play event trigger conditions vary with mobile clients, the error should be listened when the play finishing event is listened. This ensures that the callback can be correctly executed.    <br>type: Indicates the type of a message when an error occurs. The value is a string. <br>Example: function(status, type){ ... }   |

### 2. Setting and Action

The player objects that are returned by the constructors can be set using the following methods:

| Method                 | Description                          |
|----------------------|-------------------------------|
| resize(width,height) | Parameter: width: int; height: int <br>Function: Set the player width and height. <br>Returned value: none                       |
| play()                                                  | Function: Start to play video.<br>Returned value: Int (unified error code)<br><font color="red">Remark: This function is valid in the PC flash players only.</font>                                                            |
| stop()                                                  | Function: Stop to play video.<br>Returned value: Int (unified error code)<br><font color="red">Remark: This function is valid in the PC flash players only.</font>                                                            |
| pause()                                                  | Function: Pause currently played video.<br>Returned value: Int (unified error code)<br><font color="red">Remark: This function is valid in the PC flash players only.</font>                                                            |
| resume()                                                  | Function: Resume to play video.<br>Returned value: Int (unified error code)<br><font color="red">Remark: This function is valid in the PC flash players only.</font>                                                            |
| addBarrage(barrage) | Parameter: barrage://Indicates array Bullet screen information   <br> \[{   <br>"type":"content", //Indicates a message type, content: text <font color="red">(mandatory)  </font>   <br>"content":"hello world", //Indicates a text message <font color="red">(mandatory)  </font>  <br>"time":"1.101",//(Unit: second) Indicates the duration consumed after the caption adding API is called <font color="red">(mandatory)  </font>   <br>"style": "C64B03;35",// Separated by a semicolon. The first item indicates color, and the second item indicates font size (mandatory) <br>"postion":"center" //Indicates a fixed position<br>center:  Indicates a middle position; bottom:   Indicates a bottom position; up:   Indicates the top position (optional) }, ... \]  <br>Function: Adds bullet screen.     <br>Returned value: Int "Error Codes"(#errorcode) <br> Remark: <font color="red">The bullet screen function is implemented on the frontend. Developers can develop the function on the backend. This function is valid in PC flash players only.</font>                                                                                   |
| closeBarrage()                                                | Function: Closes bullet screen. Call the addBarrage API to enable the bullet screen function.  <br>Returned value: Int "Error Codes"(#errorcode)  <br> Remark: <font color="red">The bullet screen function is implemented on the frontend. Developers can develop the function on the backend.  This function is valid in PC flash players only.</font>                                                                                   |

The following table lists the unified error codes of the methods: 
  
| Error Code<span id="errorcode"></span> | Description |
|---------|---------|
| 200 | Operation is successful. | 
| 0  | The player is not fully initialized. | 
| -2 | Unknown operation command | 


## Troubleshooting

### Error Code List

Description of error codes during Web SDK use<span id="errorcode"></span>

- Error messages on the frontend

| Message  | Description                                       |
|-------|--------------------------------------------|
|An error occurs during video information parsing. Check parameter setting.| The API does not return JSON data, so the video information cannot be parsed.|
|Video information error. Please check parameter setting.| The video information is wrongly parsed.|
|Connecting to services fails. Please check network setting| Obtaining video channel information fails.|
|The service connection request is rejected.   |The flash request triggers a security exception.|
|Video data is lacking.|The video source data is lacking.|
|The LVB has finished. Please try again later. |The NetStream.Play.Stop event occurs.|
|The LVB has finished. Please try again later. |Failed to connect to the LVB source, because the LVB source does not push video content.|


- Error messages on the backend 

| Code  | Message|Description                                       |
|-------|-----------|---------------------------------------|
| 1   	|Database error|Database connection times out or an error occurs during query.|
| 2     | Failed to connect to the LVB source, because the LVB source does not push video content (hls).|The M3U8 file cannot be obtained, so no LVB source is connected.|
| 3     |The LVB has finished (HLS). |Manifest is not a valid M3U8 file, or the LVB source has finished. |
|113	| Connection times out. Please try again later.| The parameter is wrong.|
|1000 |The channel ID or application ID is wrong.| The application ID is wrong (length is incorrect).|
|1001 |Invalid parameter. Obtaining the BIZ ID fails.| The application ID is wrong (length is correct, and content is wrong).|                  
| 1009  | The LVB source has expired.| The broadcast address is invalid, or the LVB source has expired.                 |
|10000| Request times out. Please check the network setting| Request times out.|
| 10008 |Password error. Please reenter.| Invalid password                            |
|10020 | The remaining balance in the account is insufficient. Please recharge in time| The remaining balance is insufficient.|
| 11044 |Invalid request| The application ID is lacking.                                 |
| 11045 |The request parameter lacks the channel ID.| The channel ID is lacking.                            |
| 11046 |Password error. Please reenter.| Password is lacking.                           |
| 20110 |Password error. Please reenter.| Invalid password                            |
| 20113 | The LVB has finished. Please try again later. |The pull stream does not exist (downstream type is not exist).|
|20201  |The LVB has finished. Please try again later. |An error occurs during push query (get upstream info error).|
|20301  |The LVB channel does not exist. Please check the channel ID.|The channel ID is wrong (the application ID is correct).|



>Remark: In case of any error that is not listed in the preceding table, contact customer service personnel. Engineers will be arranged to solve problems. 

### FAQs

- **Why is the screen stretched when video is played on an H5?**

    A: H5 does not boast video stretching capability. Check the container width and height setting of the player.

- **I am warned "The LVB has finished. Please try again later".**

    A: This message will be given if the video source does not make response after an attempt to connect to the video source has been made five times.  Check whether the video stream is pushed and whether network connectivity is normal. 

-  **The video cannot be covered under the QQ browser.**

    A: The browser takes over the video play function of the H5, and the X5 core uses proprietary player. In view of user experience, the browser uses unified play interface.  For details, refer to "QQ Browser Description"(http://x5.tencent.com/guide?id=2009).

-  **Video is automatically played in full screen mode on the iOS.**

	A: Due to the webkit setting, the iOS system plays video in full screen mode by default. To implement inline play within an APP, set the webkit-playsinline property.  At present, Safari on versions earlier than iOS10 cannot disable the full screen function. 

-  **There are two play buttons on the flash player of the PC Chrome.**

	A: From Chrome 42, except for the main flash content, other flash will not be automatically played and is suspended by default. Users can manually enable the automatic play function for the flash. 

-  **Why video can be played on PC browser, but not smartphone browser?**

    A: At present, only HLS video can be played on smartphone browser. Check whether the LVB URL contains HLS pull URL. 
