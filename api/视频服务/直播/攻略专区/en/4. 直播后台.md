## 4.1 Functions of LVB Backend
The core function of an LVB backend is to manage and maintain the data called **studio list**, and provide the service interface for adding, deleting, modifying and querying functions related to the studio list, because most functions of an LVB solution focus on the studio:
![](//mc.qcloudimg.com/static/img/e8a2be9cf6c85a65d0cbdbaac0951228/image.png)

- **Create a Studio (Add)**
Before starting LVB, the VJ needs to first create a studio, which is equivalent to adding a piece of new data to the studio list.

- **Close a Studio (Delete)**
After an LVB process ends, the App needs to notify the backend to set the status of the studio used just now to "LVB Ended" or delete it from the list.

- **Modify Studio Status (Modify)**
When a new audience member joins, 1 needs to be added to the audience number of a studio;
When an audience member likes the VJ, 1 needs to be added to the like number of a studio;
When a video stream is interrupted unexpectedly, a notification will be received from Tencent Cloud, and the status of a studio needs to be modified;
When regulators find out that the content of a studio violates relevant regulations, the studio needs to be banned; as a result, the status of the studio changes to banned.

- **Query Studio List (Query)**
Every audience member opening the App will query the current studio list at the LVB backend.  Meanwhile, the related operator also needs to check the studio status in real time so as to conduct necessary supervision.


## 4.2 Creating a Studio 
Before initiating LVB, the App first used a protocol to request the server to create a studio:
- **Request message (App -> Server)**
The most critical information is the account ID. Meanwhile, it is preferred to attach the LVB title, geographical position, LVB cover URL and other information. The LVB backend will use the information to create a studio.

- **Packet return message (Server -> App)**
The packet return message of the server involves two situations: 1. LVB is allowed, and the information such as the push URL (as shown in the following figure) can be returned to the App; 2. the request is refused and the error reason is returned.
 > For the example implementation here in Small LVB, refer to "Detailed Explanation of Protocol - Request Push Address"(https://www.qcloud.com/doc/api/258/6454#1..E8.AF.B7.E6.B1.82.E7.9B.B4.E6.92.AD.E6.8E.A8.E6.B5.81.E5.9C.B0.E5.9D.80). Set out below is a standard push URL with an anti-leeching signature. For splicing of push URL, refer to "LVB Code - How to Allocate Push Address"(https://www.qcloud.com/doc/api/258/5649#2.-.E5.88.86.E9.85.8D.E6.8E.A8.E6.B5.81.E5.9C.B0.E5.9D.80).
> ![url](//mc.qcloudimg.com/static/img/6b4fd09ab2c7d6f1503070f8c994f4e0/image.png)

- **Modify status (New -> In LVB)**
The status of a newly created studio cannot be set to "In LVB" directly, because the VJ may not push the stream successfully. A lot of strange reasons exist here, for example, the port 1935 used for push is disabled by the security firewall of the related network, or the VJ's App is just installed, and the refusing option is selected by mistake when the camera permission application is displayed.

 The correct posture is as follows: The App is enabled to confirm push success after receiving the PUSH_BEGIN event of the RTMP SDK, and then use a protocol to notify the backend to change the studio status to "In LVB", or change the status after waiting for the push event notification from Tencent Cloud (after receiving the video data of an LVB stream, Tencent Cloud will send an event notification to the URL configured by you).
 > In Small LVB, the solution of App notification is selected here. For the example implementation, refer to "Detailed Explanation of Protocol - Modify Online Status"(https://www.qcloud.com/doc/api/258/6454#2..E4.BF.AE.E6.94.B9.E5.9C.A8.E7.BA.BF.E7.8A.B6.E6.80.81).

## 4.3 Closing a Studio
When LVB ends, the App needs to use a protocol to inform the server so that the server can delete the corresponding record as quickly as possible; otherwise the LVB list is full of offline VJs.

> For the implementation of Small LVB, refer to "Detailed Explanation of Protocol - Modify Online Status" (https://www.qcloud.com/doc/api/258/6454#2..E4.BF.AE.E6.94.B9.E5.9C.A8.E7.BA.BF.E7.8A.B6.E6.80.81).

**<font color='red'>"Advantage and Disadvantage"</font>:** 
The design solution that the App informs the server of end of LVB showcases the advantage of **high speed**. When the VJ clicks the closing button, the server can immediately learn end of the LVB. When the IM channel is configured, the audience watching LVB can be notified in real time. Surely such an interactive experience is perfect. 

However, a problem still exists, namely, some accidents may take place, for example, the VJ's mobile phone is disconnected from the network, the App crashes, or the traffic is used up unexpectedly. All of these accidents prevent the App from informing the server that the VJ is offline already. If these are not considered, some "zombie channels" will exist in the LVB list.  We have two solutions to fix this problem:

- **Receive Notification**
You can use the **"Message Notification Service" of Tencent Cloud (https://www.qcloud.com/doc/api/258/5957)**: Your server can register its own callback URL and provide it to Tencent Cloud, and Tencent Cloud will notify you when the online status of the channel you are concerned about changes.

- **Active Query**
You can use the status query interface of Tencent Cloud (**[Live_Channel_GetStatus](https://www.qcloud.com/doc/api/258/5958)**) to regularly check whether all the <font color='red'>"In LVB"</font> channels are really in the "Pushing" status. The recommended call way is one-minute polling. If a channel is offline in three consecutive polling acts, you may consider setting its status to offline.

> For the implementation of small LVB here, refer to small LVB backend PHP source codes.


## 4.4 Changing Studio Status 
- **Increase number of viewers**
When a new viewer joins a studio, it means that the number of its viewers increases by 1, which can be implemented by letting the App send a notice when the viewer enters the studio. 
> For the implementation of small LVB here, refer to "Protocol details - Modify counters" (https://www.qcloud.com/doc/api/258/6454#3..E4.BF.AE.E6.94.B9.E8.AE.A1.E6.95.B0.E5.99.A8).

-**Increase number of likes**
When a viewer sends a like to a VJ, it means that the number of its likes increases by 1, which can be implemented by letting the App send a notice to the response function for the Like button.  Of course, the full like implementation solution requires the IM channel to carry out group sending of the like message, which is not the focus of this section.
> For the implementation of small LVB here, refer to "Protocol details - Modify counters" (https://www.qcloud.com/doc/api/258/6454#3..E4.BF.AE.E6.94.B9.E8.AE.A1.E6.95.B0.E5.99.A8).

-**Unexpected stream interruption**
You can use Tencent Cloud **"Message notification service" (https://www.qcloud.com/doc/api/258/5957)**. When a video channel encounters accidental stream interruption, it will receive a notice from Tencent Cloud, which means that the status of a studio should be corrected.
> For the implementation of small LVB here, refer to small LVB backend PHP source codes.

- **Violation-caused LVB banned**
When regulators find out that the content of a studio violates relevant regulations, the studio needs to be banned; as a result, the status of the studio changes to banned. Implementation of LVB banned needs relevant backend APIs "LVB ID â€“ Enable/disable push" (https://www.qcloud.com/doc/api/258/5959).

## 4.4 Query studio list
The server returns the list of those studios in the broadcasting status to the App. Notice the following two details in the implementation:
-**Add paging logics**
If the list contains a large number of studios (more than 20 for example), it is recommended to add paging logics, which conduces to reducing server pressure and improving list display speed.
> For small LVB implementation, refer to "Protocol details - Pull list" (https://www.qcloud.com/doc/api/258/6454#4..E6.8B.89.E5.8F.96.E5.88.97.E8.A1.A8).

-**Assemble playback addresses**
With the LVB ID (or studio ID), you can simply assemble the playback address. The following are RTMP, FLV and HLS three playback addresses assembled with the LVB ID **8888_test_12345_test**. After obtain the playback URL, the App can directly send it to Tencent Cloud RTMP SDK for playback:
![play](//mccdn.qcloud.com/static/img/8438aadc91d16a1f02921bb178881893/image.png)
>**Note**
> 
> <font color = 'red'> Do not assemble the address at the App end</ font>, which will cause logics locked in the APP codes. The recommended method is that the server assembles the address and sends it back to the APP. With business growth, you may consider adding playback hotlink protection at the player end to prevent possible theft of your videos. Hotlink protection signatures can only be allocated by the server, so the assembly logic at the client end cannot meet this requirement.
