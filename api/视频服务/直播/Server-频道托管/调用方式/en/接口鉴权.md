The Tencent Cloud API will authenticate each access request, so the request must contain the signature information in its public request parameters in order to allow the API to authenticate user identity. The signature information is generated based on the security credential owned by a user. A security credential contains a secret ID and a secret key. If the user does not have a security credential, he/she can apply for a credential on the Tencent Cloud. Otherwise, the Cloud API cannot be called. 

## 1. Applying for a Security Credential
Before calling the Cloud API for the first time, apply for a security credential on the Tencent Cloud CVM console. A security credential contains a secret ID and a secret key. The secret ID is used to identify an API caller, and the secret key is used to encrypt the string of the signature and verify the string on the server. Users must keep the secret key private to avoid leakage. 

To apply for a security credential, please do the following:

1) Log in to the [Tencent Cloud Console](https://console.qcloud.com/).

2) Click Cloud Products, and choose Cloud API Key under Monitor & Management to access the Cloud API key management page.
![](//mccdn.qcloud.com/img568f5fb824757.png)

3) On the [Cloud API Key Management](https://console.qcloud.com/capi) page, click New to create a pair of SecretId/SecretKey. You can configure up to two pairs of SecretId/SecretKey for each account. 

## 2. Generating a Signature
With the SecretID and SecretKey, a signature can be generated as follows:

Suppose that the secret ID and secret key are as follows:
>  SecretId:  AKIDz8krbsJ5yKBZQpn74WFkmLPx3gnPhESA
>  SecretKey:  Gu5t9xGARNpq86cd98joQYCN3Cozk1qA

**Note: The secret ID and secret key are for reference only. Users should perform the operation according to the actual secret ID and secret key.**
The following table takes [View Instance List](/doc/api/229/Querying Instance List) (DescribeInstances) as an example to describe the possible request parameters when this API is called:

| Parameter | Description| Parameter Value| 
|---------|---------|---------|
| Action | Method name | DescribeInstances | 
| SecretId | Key ID. | AKIDz8krbsJ5yKBZQpn74WFkmLPx3gnPhESA | 
| Timestamp | Current time stamp | 1465185768 | 
| Nonce | A random positive integer | 11886 | 
| Region | Region of the instance | gz | 
| instanceIds.0 | ID of the instance to be queried | ins-09dx96dg | 
| offset | Offset value | 0 | 
| limit | Maximum output | 20 | 

As you can see, there are only five general parameters (Action, SecretId, Timestamp, Nonce, and Region).  Actually, the sixth general parameter "Signature" is generated by other parameters (including the instruction request parameters) as follows:
### 2.1. Sorting Parameters
Sort request parameters by their names in lexicographic order ascendingly. In this way, parameters are sorted based on the first letter. If the first letters of the parameters are the same, they will be sorted based on the second letter. You can use relevant sorting functions of your programming language to implement the sorting, for example, the ksort function of PHP. The sorting result of the preceding parameters is as follows: 

```
{
    'Action' : 'DescribeInstances',
    'Nonce' : 11886,
    'Region' : 'gz',
    'SecretId' : 'AKIDz8krbsJ5yKBZQpn74WFkmLPx3gnPhESA',
    'Timestamp' : 1465185768,
	'instanceIds.0' : 'ins-09dx96dg',
    'limit' : 20,
    'offset' : 0,
}
```
You can use another programming language to sort the preceding parameters. A result consistent with that in the preceding sorting result is acceptable. 
### 2.2. Combining a Request String
This step is used to generate a request string.
Format the preceding sorted parameters as "parameter name=parameter value". For example, format the parameter Action as "Action=DescribeInstances". 
**Note: 1. The parameter value is the original value, not a URL encoded value.  2. If a parameter contains underscore, convert the character into ".".**

Then, combine the formatted parameters together using "&" to generate a string: 

```
Action=DescribeInstances&Nonce=11886&Region=gz&SecretId=AKIDz8krbsJ5yKBZQpn74WFkmLPx3gnPhESA&Timestamp=1465185768&instanceIds.0=ins-09dx96dg&limit=20&offset=0
```

### 2.3. Combining a Signed Source String
This step is used to generate a signed source string. 
The signed source string is composed of the following parameters: 

1) Request method:  The POST and GET methods are supported. For a GET request, the method must be in upper-case.
2) Request CVM: The request domain name of the "Querying Instance List" (/doc/api/229/Querying Instance List)(DescribeInstances) is cvm.api.qcloud.com.  The actual request domain name varies with the module an API belongs to. For details, refer to corresponding API description.
3) Request path:   The request path of the Cloud API is /v2/index.php fixedly.
4) Request string:   Indicates the request string generated in the preceding step.

Combination rule of signed source string:
> Request method + Request CVM +Request path + ? + Request string

The combination result is as follows:

```
GETcvm.api.qcloud.com/v2/index.php?Action=DescribeInstances&Nonce=11886&Region=gz&SecretId=AKIDz8krbsJ5yKBZQpn74WFkmLPx3gnPhESA&Timestamp=1465185768&instanceIds.0=ins-09dx96dg&limit=20&offset=0
```

### 2.4. Generating a signature
This step is used to generate a signature.
Perform the HMAC-SHA1 algorithm to sign the **signed source string**, and then encode the signature using Base64 to obtain the final signature.

The specific coding is as follows (the PHP language is used):

```
$secretKey = 'Gu5t9xGARNpq86cd98joQYCN3Cozk1qA';
$srcStr = 'GETcvm.api.qcloud.com/v2/index.php?Action=DescribeInstances&Nonce=11886&Region=gz&SecretId=AKIDz8krbsJ5yKBZQpn74WFkmLPx3gnPhESA&Timestamp=1465185768&instanceIds.0=ins-09dx96dg&limit=20&offset=0';
$signStr = base64_encode(hash_hmac('sha1', $srcStr, $secretKey, true));
echo $signStr;
```

The final signature is as follows:

```
NSI3UqqD99b/UJb4tbG/xZpRW64=
```

You can use another programming language to verify the signature based on the source text. A signed string consistent with that in the preceding example is acceptable. 

## 3. Encoding a Signature
The generated signature cannot be directly used as a request parameter, and it must be encoded using URL. 
**Note: If the GET method is used, all request parameters must be encoded using URL.**
For example, the generated signature is NSI3UqqD99b/UJb4tbG/xZpRW64=. After it is encoded, the signature is NSI3UqqD99b%2FUJb4tbG%2FxZpRW64%3D. This is the final signature and will be used to generate the final request URL.
