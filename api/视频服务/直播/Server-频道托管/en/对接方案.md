# Channel Hosting Solution
## Solution Overview
Tencent Cloud video LVB service mainly provides the following functions: audio and video channel, CDN acceleration, and LVB stream management service. The **channel hosting solution** is an LVB stream management method and corresponds to the [**LVB Code Management Solution**] (https://www.qcloud.com/doc/api/258/5649).

**A channel** refers to an LVB stream. Channel hosting refers that LVB streams are completely maintained and managed by Tencent Cloud. You need to only access the Tencent Cloud entries for channel query, channel creation, channel modification, and channel deletion, just as you access the database, to complete your business logic.

- **Advantages**
Channel hosting provides the fully visualized exchange and humanized operations. All the addition, deletion, modification, and query operations on channels (LVB streams) in the channel hosting solution can be completed using UI buttons on the [LVB Console] (https://console.qcloud.com/live/livemanage), and you can perform operations without expertise. This solution is highly advantageous if you carry out LVB theme activities.

- **Disadvantages**
If you need to implement a complex APP to add, delete, modify, or query channels (LVB streams) at high load all the time and to ensure the high accuracy and consistency of LVB states, the channel hosting solution is inferior to the LVB code management solution in terms of the degree of freedom, interworking cost, and maintenance cost.

The following uses several steps to describe how to create complete closed-loop LVB experience by using the channel hosting solution. In addition, the LVB [Interworking Method](https://www.qcloud.com/doc/api/258/5649) also has a similar solution:
![](//mccdn.qcloud.com/static/img/5f9f08330b500d2c81b7c28be5307fee/image.png)

## LVB List
A basic facility is required on your server so that the channel hosting solution can be used, and the basic facility is the **LVB channel list**. This list buffers channels that are in the LVB state and your APP (watchers) can obtain the LVB list at any time:
![](//mc.qcloudimg.com/static/img/f64b39ec200d1bc3c74d45ae32d04982/image.png)

>  **Why does the channel list need to be buffered on the APP:**
>  You may have the question: Tencent Cloud already manages a channel list and you can even view the list on the console, why do I need to buffer the channel list?
>  The channel list needs to be buffered from three dimensions:
>  (1) Tencent Cloud channel list provides basic information such as the channel name and channel ID, and does not provide the user portrait, cover, position, thumbs-up clicking count, and other personalized customized information.
>  (2) The access frequency of Tencent Cloud server APIs is limited and the default frequency is 100 times per second. The access will be rejected after the access frequency is out of range. Therefore, the buffering of the channel list on your server can avoid the access frequency limit and reduce the waiting time for APP users to load the list.

## Interworking Guide
### Step 1: Create a channel.
Before starting LVB, a VJ needs to **create a channel**. You can call [CreateLVBChannel] (https://www.qcloud.com/doc/api/258/4715) to obtain a channel ID and RTMP push URL. In addition, the created channel needs to be added to the above-mentioned **LVB channel list**.

### Step 2: Enable the SDK to push streams.
Step 2 If no exception occurs, your server will receive a push URL and return it to your APP. The APP completes the remaining work: The APP sends the push URL to the RTMP SDK to push streams. For details, see "Push SDK Introduction" (http://www.qcloud.com/doc/api/258/4734).

### Step 3: Delete the channel.
If the push on the APP ends, the APP needs to notify the backend to **delete the channel**. Note that <font color='red'>a channel that is not stopped may fail to be deleted</font>. Therefore, before deleting a channel, call the [StopLVBChannel] (https://www.qcloud.com/doc/api/258/4720) API to set the channel to the stopped state and then call the [DeleteLVBChannel] (https://www.qcloud.com/doc/api/258/4722) API to delete the channel.

After a channel is deleted, delete it from your buffered **LVB channel list** synchronously.
![1-3](//mc.qcloudimg.com/static/img/3cc24ef70bf5d0adfa6612d0eab77bb5/image.png)

The preceding three steps implement the logic on the VJ side. The following describes the logic on the watcher side:

### Step 4: Query the channel list.
After a user starts your APP, the user checks the LVB list. You can return the buffered LVB channel list to the user (supplemented with the cover, position, thumbs-up clicking count, and other supplementary information).

The play URL can be obtained when a channel is created in Step 1. You can also assemble the play URL on your server. The assembly rules are as follows:
![simple url](//mc.qcloudimg.com/static/img/cb33257ac2623be2296b3f34a1927ae7/image.png)

>  **Do not assemble the URL on the APP:**
>  Do not assemble the play URL on the APP client. Otherwise, the flexibility will be restricted. The server can update the URL assembly rules repeatedly but the client cannot.

### Step 5: Use the SDK to play the video.
A watcher selects a favorite VJ in the LVB list, and clicks to enter the video watch screen. The APP selects the play URL in the LVB list loaded in Step 4. Then, the play SDK provided  by Tencent Cloud plays the video. For details, see "Play SDK Introduction" (http://www.qcloud.com/doc/api/258/4736).

### Step 6: Handle zombie channels.
Zombie channels are channels that are not used after creation and are not reclaimed. Such channels increase the number of created channels. As a result, the number of channels that you can create  descends and even cause overrange (the error code 20101 is reported).

If interworking is conducted according to Step 1 through Step 3, the channel creation and deletion are always initiated only by the APP and a hidden trouble will be incurred: The APP may not exit normally (breaks down or forcibly shut down at the backend) after the LVB starts. As a result, the APP is always in the "non-LVB" state and eventually becomes a zombie channel.

To prevent this problem, the best method is to add a **"custom recovery mechanism"** on your server:
- **Polling module**: Your server calls [DescribeLVBChannelList] (https://www.qcloud.com/doc/api/258/4716) every other three minutes to obtain the channel list (if channelStatus == 0 is specified, only IDs of channels that are not in the push state are returned).

- **Recycling module**: If the status of a channel ID is always <font color='red'>no input stream</font> in consecutive three polling cycles (that is, the channel does not push streams for nine minutes), it can be judged that the channel is a zombie channel. You can stop and reclaim the channel ([StopLVBChannel] (https://www.qcloud.com/doc/api/258/4720) + [DeleteLVBChannel] (https://www.qcloud.com/doc/api/258/4722)).

![](//mc.qcloudimg.com/static/img/e663d5652dc086a6239f1224274f2c16/image.png)


## FAQs

### 1. What should I do when the channel quantity exceeds the limit?
After interworking, some customers may always receive the error code 20101 (the channel quantity exceeds the upper limit) when they call [CreateLVBChannel] (http://www.qcloud.com/doc/api/258/4703). The cause is that Tencent Cloud LVB service limits the number of channels that can be created by a single customer.

The threshold is very large. In general, the channel quantity will not exceed the threshold unless a logic error occurs. If the error code 20101 is reported frequently, zombie channels accumulate. You are recommended to perform **Step 6** to make adjustment.

### 2. What should I do when user quantity equals channel quantity?
In many customers' opinion, the channel quantity should equal the number of prospective VJs on the APP. It can be implemented by using technologies but is not economical. On one hand, more than 99% of channels are idle according to the normal development rules. On the other hand, after a user is directly bound with a channel ID, the channel IDs of top VJs can be easily detected. Therefore, more complex protection mechanisms are required to defend against security risks.

The solution recommended above is a dynamic channel creation and recycling solution. It can ensure that channels are in use at most time. In addition, each channel is dynamically created and is not bound with a user ID. It is difficult to launch security attacks.

### 3. How do we protect the push address?
Many customers fear the disclosure of push addresses. Actually, the fear is groundless in the channel hosting solution:

On one hand, if a push address is being used for pushing, another client cannot occupy it. This is the basic protection.

On the other hand, if you deploy the channel hosting solution in the recommended mode, the channel created by each VJ is dynamically generated each time. <font color='red'>The major advantage of dynamic channel creation is that the push address is calculated randomly</font> and it is very difficult to guess and attack the address. In addition, after the LVB ends, the APP notifies the backend to reclaim the channel. The correct guess and attack costs are very high and it is unnecessary to provide special protection.

### 4. How are channels charged?
The channel charge of Tencent Cloud is based on the maximum concurrency count of **LVB channels**, that is, the number of VJs who launch LVB online simultaneously.

High backend server computing expenses will be generated for an active channel, including transcoding, retrieval, statistics, and necessary monitoring. In consideration of costs, Tencent Cloud collects backend server computing charges based on the concurrency quantity of LVB channels. If the concurrency quantity is smaller than or equal to **5**, the channels are free of charge; if the number of concurrent channels is greater than **5**, the concurrency quantity out of 5 is charged **60 CNY/concurrency/month**.



