为了帮助用户快速使用黑石物理服务器私有网络API，这里给出一个使用示例，能够引导用户使用API服务实现物理服务器的虚拟化。

## 1. 物理服务器加入虚拟子机所在子网

首先，我们要先创建一个VLANID不为5的子网，同一个VPC内，多个子网的网段不能重叠，VLANID 不为5的子网VLANID不能重叠。具体请参考<a href="https://www.qcloud.com/document/api/386/9263" title="创建黑石子网">创建黑石子网接口</a>。
默认情况下，物理机所在的子网VLANID为5。如果物理服务器和虚拟子机所在的子网相同，则无需进行这一步操作。当虚拟子机所在子网与物理服务器所在子网不是同一个子网的时候，虚拟子机如果没有调用这个接口，则虚拟子机不能正常访问。


物理服务器加入子网需要的具体请求参数见下表：

| 参数名称 | 是否必选  | 类型 | 描述 |
|---------|---------|---------|---------|
| vpcId | 是 | String | 子网所属的私有网络ID值，可使用vpcId或unVpcId，建议使用unVpcId，例如：vpc-kd7d06of。可通过DescribeBmVpcEx接口查询。 |
| subnetId | 是 | String | 子网ID值，可使用subnetId或unSubnetId，建议使用unsubnetId，例如：subnet-k20jbhp0。可通过DescribeBmSubnetEx接口查询。 |
| instanceIds | 是 | Array | 物理机唯一ID，例如：cpm-k20jbhp0。可通过DescribeDeviceClass接口查询。每次最多支持10台机器加入子网 |

综上，结合公共请求参数和接口请求参数，最终得到的请求形式如下：

```
  https://vpc.api.qcloud.com/v2/index.php?Action=CreateBmInterface
	&<公共请求参数>
	&vpcId=vpc-34cxlz7z
    &subnetId=subnet-pohv7d8w
    &instanceIds.0=tcpm-rewhxuo7
```

上述请求的返回结果如下，由于加入操作是异步操作，需要调用<a href="https://www.qcloud.com/document/api/386/9267">查询任务状态接口</a>查询加入结果。

```
{
	"code": 0,
	"message": "",
	"data": {
		"taskId": 9641,
		"resourceIds": ["tcpm-rewhxuo7"]
	}
}
```

接着，需要调用IP分配接口进行IP地址分配，如果不需要指定IP地址分配，可以调用<a href="https://www.qcloud.com/document/api/386/7337">申请子网IP接口</a>进行IP分配，如果需要指定IP地址分配，可以调用<a href="https://www.qcloud.com/document/api/386/7925">注册子网IP接口</a>进行IP注册。为了避免您的IP地址资源冲突，请您对已使用的IP进行注册，避免发生IP冲突的情况。

最后，我们需要把已经分配出来的IP地址配置到虚拟机上，这样虚拟机就能正常访问了。


## 2. 物理服务器移除虚拟子机所在子网。

当虚拟子机销毁的时候，我们需要调用<a href="https://www.qcloud.com/document/api/386/7338">退还IP地址接口</a>把虚拟子机所使用的IP地址进行释放，避免占用IP资源。当物理服务器上的所有虚拟子机都已经被销毁的时候，请及时调用物理服务器移除子网接口，清理机器在交换机上的配置。

具体的接口请求参数见下表：

| 参数名称 | 是否必选  | 类型 | 描述 |
|---------|---------|---------|---------|
| vpcId | 是 | String | 子网所属的私有网络ID值，可使用vpcId或unVpcId，建议使用unVpcId，例如：vpc-kd7d06of。可通过DescribeBmVpcEx接口查询。 |
| subnetId | 是 | String | 要删除的子网ID值，可使用subnetId或unSubnetId，建议使用unsubnetId，例如：subnet-k20jbhp0。可通过DescribeBmSubnetEx接口查询。 |
| instanceIds | 是 | Array | 物理机唯一ID，例如：cpm-k20jbhp0。可通过DescribeDeviceClass接口查询。每次最多支持10台机器加入子网 |

结合公共请求参数和接口请求参数，最终得到的请求形式如下：

```
  https://vpc.api.qcloud.com/v2/index.php?Action=DelBmInterface
	&<公共请求参数>
	&vpcId=vpc-34cxlz7z
    &subnetId=subnet-pohv7d8w
    &instanceIds.0=tcpm-rewhxuo7
```

上述请求的返回结果如下，由于移除操作是异步操作，需要调用<a href="https://www.qcloud.com/document/api/386/9267">查询任务状态接口</a>查询加入结果。

```
{
	"code": 0,
	"message": "",
	"data": {
		"taskId": 9641,
		"resourceIds": ["tcpm-rewhxuo7"]
	}
}
```

## 3. 查询子网IP分配列表。

黑石私有网络提供了查询子网所有已分配IP列表的接口，<a href="https://www.qcloud.com/document/api/386/9318">详情请查看</a>。

具体的接口请求参数见下表：

| 参数名称 | 是否必选  | 类型 | 描述 |
|---------|---------|---------|---------|
| vpcId | 是 | String | 子网所属的私有网络ID值，可使用vpcId或unVpcId，建议使用unVpcId，例如：vpc-kd7d06of。可通过DescribeBmVpcEx接口查询。 |
| subnetId | 是 | String | 要删除的子网ID值，可使用subnetId或unSubnetId，建议使用unsubnetId，例如：subnet-k20jbhp0。可通过DescribeBmSubnetEx接口查询。 |

结合公共请求参数和接口请求参数，最终得到的请求形式如下：

```
  https://vpc.api.qcloud.com/v2/index.php?Action=DescribeBmSubnetIps
	&<公共请求参数>
	&vpcId=vpc-kd7d06of
    &subnetId=subnet-1so5ae8m
```

上述请求的返回结果如下。

```
{
    "code": 0,
    "message": "",
    "codeDesc": "Success",
    "data": {
        "cpmSet": [
            "10.10.1.2"
        ],
        "vmSet": [
            "10.10.1.5"
        ],
        "tgSet": [
			"10.10.1.10"
		]
    }
}
```
## 4. 查询物理机加入的子网列表。

黑石私有网络提供了查询物理机加入的子网列表的接口，<a href="https://www.qcloud.com/document/api/386/9320">详情请查看</a>。

具体的接口请求参数见下表：

| 参数名称 | 是否必选  | 类型 | 描述 |
|---------|---------|---------|---------|
| instanceId | 是 | String | 物理机资源的唯一ID，例如：cpm-kd7d06of。可通过DescribeDevice接口查询。 |

结合公共请求参数和接口请求参数，最终得到的请求形式如下：

```

  https://vpc.api.qcloud.com/v2/index.php?Action=DescribeBmSubnetByCpmId
	&<公共请求参数>
	&instanceId=tcpm-rewhxuo7
```

上述请求的返回结果如下。

```
{
    "code": 0,
    "message": "",
    "codeDesc": "Success",
    "subnetSet": [
        {
            "unVpcId": "vpc-muinpf9p",
            "vpcId": 4100,
            "subnet": "10.1.0.0",
            "cidr": "10.1.0.0/24"
        }
    ]
}
```

## 5. 查询加入到子网的所有物理机列表。

黑石私有网络提供了查询加入到子网的所有物理机列表接口，<a href="https://www.qcloud.com/document/api/386/9319">详情请查看</a>。

具体的接口请求参数见下表：

| 参数名称 | 是否必选  | 类型 | 描述 |
|---------|---------|---------|---------|
| vpcId | 是 | String | 子网所属的私有网络ID值，可使用vpcId或unVpcId，建议使用unVpcId，例如：vpc-kd7d06of。可通过DescribeBmVpcEx接口查询。 |
| subnetId | 是 | String | 要删除的子网ID值，可使用subnetId或unSubnetId，建议使用unsubnetId，例如：subnet-k20jbhp0。可通过DescribeBmSubnetEx接口查询。 |

结合公共请求参数和接口请求参数，最终得到的请求形式如下：

```
  https://vpc.api.qcloud.com/v2/index.php?Action=DescribeBmCpmBySubnetId
	&<公共请求参数>
	&vpcId=vpc-kd7d06of
    &subnetId=subnet-1so5ae8m
```

上述请求的返回结果如下。

```
{
    "code": 0,
    "message": "",
    "codeDesc": "Success",
    "cpmSet": [
        {
            "instanceId": "cpm-6y3le68b"
        },
        {
            "instanceId": "cpm-4713mhup"
        }
    ]
}
```


